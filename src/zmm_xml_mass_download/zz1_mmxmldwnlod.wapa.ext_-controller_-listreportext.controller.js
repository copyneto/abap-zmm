sap.ui.define([],function(){"use strict";return{aMessages:new Array,oMsgDialog:undefined,onInit:function(e){this.oMsgDialog=new sap.m.Dialog({resizable:true,type:"Message",icon:"sap-icon://alert",title:this.getOwnerComponent().getModel("i18n").getResourc+
eBundle().getText("MessageViewTitle"),state:"Information",contentHeight:"50%",contentWidth:"50%",verticalScrolling:false,beginButton:new sap.m.Button({press:function(){this.getParent().close()},text:"Close"})})},onAfterRendering:function(e){let t=this.ge+
tView().byId("listReportFilter");t.addEventDelegate({onAfterRendering:function(e){let t=this.getOwnerComponent().getModel("i18n").getResourceBundle();e.srcControl._oSearchButton.setText(t.getText("execButton"))}.bind(this)})},downloadXml:function(e){let +
t=this.getView();let n=sap.ui.core.Fragment.load({id:t.getId(),name:"br.com.trescoracoes.xmldownload.ext.view.download",controller:this}).then(function(e){t.addDependent(e);return e});n.then(function(e){e.open()})},onClose:function(e){this.byId("download+
Dialog").close();this.byId("downloadDialog").destroy();this.getView().removeAllDependents()},onAccept:function(e){this.aMessages.length=0;let t=this.getView().byId("path");let n=this.getView().byId("pnlOptions");let o=n.getItems().length>1?false:true;let+
 s=this.getView().getModel("fileService").sServiceUrl;let i=[];if(!t.getValue()&&this.byId("rbServer").getSelected()){t.setValue("/usr/sap/tmp/")}for(let e of n.getItems()){if(e instanceof sap.m.CheckBox&&e.getSelected()){switch(e.getId().split("--").pop+
()){case"cbDanfe":for(let e of this.buildParam("downloadNfes",false)){i.push(this.downloadNfe(window.location.origin+s,e))}break;case"cbCte":for(let e of this.buildParam("downloadCtes",false)){i.push(this.downloadCte(window.location.origin+s,e))}break;de+
fault:break}}}this.onClose();this.getView().setBusy(true);let r=this.templateBaseExtension.getExtensionAPI();for(let e of i){r.securedExecution(e.then(this.download.bind(this),this.handleMessages.bind(this)).finally(this.showMessages.bind(this)),{busy:{s+
et:true,check:false},sActionLabel:"Log de solicitação"})}},download:function(e){sap.m.URLHelper.redirect(e+"/$value",true)},downloadNfe:function(e,t){return new Promise(function(n,o){this.getView().getModel("fileService").read("/xmlCheckNfeSet(Docnum='"++
t.docnum+"',Filepath='"+encodeURIComponent(t.filepath)+"',Local="+t.server+")",{success:function(s,i){if(!s.Filepath)n(e+"/xmlDownloadNfes"+encodeURIComponent(JSON.stringify(t).replaceAll('":',"=").replaceAll(',"',",").replaceAll('{"',"(").replaceAll("}"+
,")").replaceAll('"',"'")));else o({type:"Success",message:"XML Docnum "+s.Docnum+" gravado com sucesso na pasta "+t.filepath,param:s.Docnum})},error:function(e){let t=JSON.parse(e.responseText);t.type="Error";o(t)}})}.bind(this))},downloadCte:function(e+
,t){return new Promise(function(n,o){this.getView().getModel("fileService").read("/xmlCheckCteSet(Docnum='"+t.docnum+"',Filepath='"+encodeURIComponent(t.filepath)+"',Local="+t.server+")",{success:function(s,i){if(!s.Filepath)n(e+"/xmlDownloadCtes"+encode+
URIComponent(JSON.stringify(t).replaceAll('":',"=").replaceAll(',"',",").replaceAll('{"',"(").replaceAll("}",")").replaceAll('"',"'")));else o({type:"Success",message:"XML Docnum "+s.Docnum+this.getOwnerComponent().getModel("i18n").getResourceBundle().ge+
tText("Mensagem")+t.filepath,param:s.Docnum})},error:function(e){let t=JSON.parse(e.responseText);t.type="Error";o(t)}})}.bind(this))},showMessages:function(){this.getView().setBusy(false);if(this.aMessages.length<=0)return;let e=new sap.ui.model.json.JS+
ONModel;e.setData(this.aMessages);let t=new sap.m.MessageItem({type:"{type}",title:"{title}",description:"{description}",subtitle:this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("MensagemErroSubtitulo")+" {subtitle}",link:new sap.m.+
Link({text:"{info}",href:"{link}",target:"_blank"})});let n=new sap.m.MessageView({showDetailsPageHeader:true,items:{path:"/",template:t}});n.setModel(e);if(this.oMsgDialog){this.oMsgDialog.removeAllContent()}this.oMsgDialog.addContent(n);this.oMsgDialog+
.open()},handleMessages:function(e){this.aMessages.push({type:e.type,title:this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("Mensagem"+e.type+"Titulo"),description:e?.error?.message.value==undefined?e.message:e?.error?.message.value,+
subtitle:e?.error?.innererror.transactionid==undefined?e.param:e?.error?.innererror.transactionid,info:e?.error?.innererror.Error_Resolution.SAP_Note.split("(")[1].replace(")",""),link:e?.error?.innererror.Error_Resolution.SAP_Note.split("(")[1].replace(+
")","")})},onShowInput:function(e){let t=this.getView().byId("fup");if(e.getSource().getSelectedIndex()===0){t.setVisible(false);return}t.setVisible(true)},serviceParamFactory(e){let t=[];let n=this.templateBaseExtension.getExtensionAPI();for(let o of n.+
getSelectedContexts()){let n={};n.inline=e;n.server=this.byId("rbServer").getSelected();n.filepath=this.byId("path").getValue();n.docnum=o.getObject().docnum;t.push(n)}return t},paramNfeFactory:function(e){return this.serviceParamFactory(e)},paramCteFact+
ory:function(e){return this.serviceParamFactory(e)},buildParam:function(e,t){let n;switch(e){case"downloadNfes":n=this.paramNfeFactory(t);case"downloadCtes":n=this.paramCteFactory(t);default:break}return n}}});                                             