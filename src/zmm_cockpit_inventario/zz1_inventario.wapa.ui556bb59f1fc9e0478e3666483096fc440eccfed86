sap.ui.define([                                                                                                                                                                                                                                                
    "sap/ui/export/Spreadsheet",                                                                                                                                                                                                                               
    "sap/ui/export/library"],                                                                                                                                                                                                                                  
    function (spreadsheet, library ) {                                                                                                                                                                                                                         
        "use strict";                                                                                                                                                                                                                                          
        return {                                                                                                                                                                                                                                               
            onActionExportExcel: function (oEvent) {                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura Serviço OData onde será extraído os dados                                                                                                                                                                                            
                =================================================================== */                                                                                                                                                                         
                var vServiceUrl = "/sap/opu/odata/sap/ZUI_O2_MM_INVENTARIO_EXP";                                                                                                                                                                               
                var oModel = new sap.ui.model.odata.ODataModel(vServiceUrl, false);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Monta filtro com a linha selecionada&nbsp;                                                                                                                                                                                                     
                =================================================================== */                                                                                                                                                                         
                var sObject = oEvent.getSource().getBindingContext().getObject();                                                                                                                                                                              
                var aFilters = [new sap.ui.model.Filter('Documentid', sap.ui.model.FilterOperator.EQ, sObject.Documentid)];                                                                                                                                    
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Configura colunas do excel                                                                                                                                                                                                                     
                =================================================================== */                                                                                                                                                                         
                var aCols = [];                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Material',                                                                                                                                                                                                                         
                    property: 'Material',                                                                                                                                                                                                                      
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Descrição Material',                                                                                                                                                                                                               
                    property: 'MaterialText',                                                                                                                                                                                                                  
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Centro',                                                                                                                                                                                                                           
                    property: 'Plant',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Descrição Centro',                                                                                                                                                                                                                 
                    property: 'PlantText',                                                                                                                                                                                                                     
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Depósito',                                                                                                                                                                                                                         
                    property: 'Storagelocation',                                                                                                                                                                                                               
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Descrição Depósito',                                                                                                                                                                                                               
                    property: 'StorageLocationText',                                                                                                                                                                                                           
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Quantidade em Estoque',                                                                                                                                                                                                            
                    property: 'Quantitystock',                                                                                                                                                                                                                 
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Diferença contagem',                                                                                                                                                                                                               
                    property: 'Balance',                                                                                                                                                                                                                       
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Quantidade contagem',                                                                                                                                                                                                              
                    property: 'Quantitycount',                                                                                                                                                                                                                 
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Diferença atual',                                                                                                                                                                                                                  
                    property: 'Balancecurrent',                                                                                                                                                                                                                
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Quantidade Estoque atual',                                                                                                                                                                                                         
                    property: 'Quantitycurrent',                                                                                                                                                                                                               
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Hierarquia de Produtos',                                                                                                                                                                                                           
                    property: 'ProductHierarchy',                                                                                                                                                                                                              
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Nº lote',                                                                                                                                                                                                                          
                    property: 'Batch',                                                                                                                                                                                                                         
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Preço Qtd estoque',                                                                                                                                                                                                                
                    property: 'Pricestock',                                                                                                                                                                                                                    
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Peso Bruto',                                                                                                                                                                                                                       
                    property: 'Weight',                                                                                                                                                                                                                        
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Preço contagem',                                                                                                                                                                                                                   
                    property: 'Pricecount',                                                                                                                                                                                                                    
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Preço diferença',                                                                                                                                                                                                                  
                    property: 'Pricediff',                                                                                                                                                                                                                     
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama Serviço                                                                                                                                                                                                                                  
                =================================================================== */                                                                                                                                                                         
                oModel.read("/ZC_MM_INVENTARIO_ITEM", {                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    filters: aFilters,                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    success: function (oData) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        // Configurações do arquivo                                                                                                                                                                                                            
                        var oSettings = {                                                                                                                                                                                                                      
                            workbook: {                                                                                                                                                                                                                        
                                columns: aCols,                                                                                                                                                                                                                
                            },                                                                                                                                                                                                                                 
                            dataSource: oData.results,                                                                                                                                                                                                         
                            fileName: sObject.Countid + '.xlsx'                                                                                                                                                                                                
                        };                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        // Baixar arquivo excel                                                                                                                                                                                                                
                        var oSheet = new spreadsheet(oSettings);                                                                                                                                                                                               
                        oSheet.build().finally(function () {                                                                                                                                                                                                   
                            oSheet.destroy();                                                                                                                                                                                                                  
                        });                                                                                                                                                                                                                                    
                    }.bind(this),                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    error: function (oError) {                                                                                                                                                                                                                 
                        alert('Falha ao extrair os dados');                                                                                                                                                                                                    
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
            }                                                                                                                                                                                                                                                  
        };                                                                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               