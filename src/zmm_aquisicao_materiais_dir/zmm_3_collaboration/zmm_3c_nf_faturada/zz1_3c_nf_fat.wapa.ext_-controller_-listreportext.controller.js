sap.ui.define(["sap/m/PDFViewer"],function(e){"use strict";return{onActionDownloadZip:function(e){let t=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();if(!t.length){sap.m.MessageToast.show("Nenhum registro selecionado.");return}var s=+
"/sap/opu/odata/sap/ZUI_O2_3C_NF_FATURADA";var o=new sap.ui.model.odata.ODataModel(s,false);o.read("/ZI_MM_3C_VH_PASTA_SERVIDOR",{success:function(e){switch(e.results.length){case 0:sap.m.MessageBox.error("Nenhum diretório de servidor cadastrado no parâm+
etro: MM / 3COLLABORATION / PASTASERV");break;case 1:this.downloadZipPopUp(e.results);break;default:sap.m.MessageBox.error("Favor cadastrar apenas um diretório de servidor no parâmetro: MM / 3COLLABORATION / PASTASERV");break}}.bind(this),error:function(+
e){sap.m.MessageBox.error("Nenhum diretório de servidor cadastrado no parâmetro: MM / 3COLLABORATION / PASTASERV")}.bind(this)})},downloadZipPopUp:function(e){var t=this;let s=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();if(!s.lengt+
h){sap.m.MessageToast.show("Nenhuma linha selecionado.");return}var o=new sap.ui.layout.VerticalLayout({width:"100%",content:[new sap.m.Text({text:"Selecione o tipo de download desejado"}),new sap.m.Text({text:" "}),new sap.m.RadioButtonGroup({id:"rbg2",+
columns:2,select:this.checkboxFile,buttons:[new sap.m.RadioButton({id:"local",text:"Local"}),new sap.m.RadioButton({id:"servidor",text:"Servidor"})]}),new sap.m.Text({text:" "}),new sap.ui.layout.VerticalLayout({id:"servidorContent",width:"100%",content:+
[new sap.m.Label({text:"Diretório Servidor"}),new sap.m.Input("inServidor",{width:"100%",value:e[0].ServerFolder,editable:false})]})]});var a=new sap.m.Dialog({type:"Message",title:"Baixar ZIP",resizable:true,draggable:true,titleAlignment:sap.m.TitleAlig+
nment.Center,content:o,beginButton:new sap.m.Button({type:sap.m.ButtonType.Emphasized,text:"Download",press:function(){a.close();if(sap.ui.getCore().byId("local").getSelected()){t.localDownloadZipFile()}else{var e=sap.ui.getCore().byId("inServidor").getV+
alue();t.serverDownloadZipFile(e)}}}),endButton:new sap.m.Button({text:"Cancelar",press:function(){a.close()}}),afterClose:function(){a.destroy()},contentWidth:"20%"});a.open();sap.ui.getCore().byId("servidorContent").setVisible(false)},checkboxFile:func+
tion(e){if(e.mParameters.selectedIndex==0){sap.ui.getCore().byId("servidorContent").setVisible(false)}else{sap.ui.getCore().byId("servidorContent").setVisible(true)}},localDownloadZipFile:function(){let t=this.templateBaseExtension.getExtensionAPI().getS+
electedContexts();let s=50;let o={};for(let e=0;e<t.length;e++){if(!o[Math.floor(e/s)]){o[Math.floor(e/s)]=[]}o[Math.floor(e/s)].push(t[e].getObject())}for(let c=0;c<Math.ceil(t.length/s);c++){var a=o[c].reduce(function(e,t){return e+t.NumRegistro+";"},"+
");var r=o[c].reduce(function(e,t){return e+t.Doctype+";"},"");var n=o[c].reduce(function(e,t){return e+t.Guid+";"},"");this.sync_wait(1e3);var i="localDownloadSet(Docnum='"+a+"',Doctype='"+r+"',Guid='"+n+"')/$value";var l="/sap/opu/odata/SAP/ZMM_3C_NF_F+
ATURADA_SRV/";var u=l+i;var d=new e;this.getView().addDependent(d);d.setSource(u);d.downloadPDF()}},serverDownloadZipFile:function(e){let t=this.templateBaseExtension.getExtensionAPI().getSelectedContexts();var s="serverDownloadSet";var o="/sap/opu/odata+
/SAP/ZMM_3C_NF_FATURADA_SRV/";var a=new sap.ui.model.odata.ODataModel(o,false);let r=50;let n={};for(let e=0;e<t.length;e++){if(!n[Math.floor(e/r)]){n[Math.floor(e/r)]=[]}n[Math.floor(e/r)].push(t[e].getObject())}for(let e=0;e<Math.ceil(t.length/r);e++){+
let t=[];for(let s=0;s<n[e].length;s++){var i=new sap.ui.model.Filter("Docnum",sap.ui.model.FilterOperator.EQ,n[e][s].NumRegistro);t.push(i);var i=new sap.ui.model.Filter("Doctype",sap.ui.model.FilterOperator.EQ,n[e][s].Doctype);t.push(i);var i=new sap.u+
i.model.Filter("Guid",sap.ui.model.FilterOperator.EQ,n[e][s].Guid);t.push(i)}this.sync_wait(1e3);var l=function(){return new Promise(function(e,o){a.read(s,{filters:t,success:function(t,s){e();sap.m.MessageToast.show(t.results[0].Message)}.bind(this),err+
or:function(e){o();let t=[];for(const s of e.response.body.matchAll(/(?:<message>(.*?)<[/]message>)/gm)){t.push(s[1])}if(t.length==0){sap.m.MessageBox.error("Falha na solicitação HTTP: Número de registros muito grande, utilizar programa JOB");return}this+
.showLog(e.response.body)}.bind(this)})}.bind(this))}.bind(this);this.extensionAPI.securedExecution(l,{busy:{set:true,check:false},sActionLabel:"Mensagens"})}},showSuccessMessage:function(e){this.getView().setBusy(false)},showErrorMessage:function(e){thi+
s.getView().setBusy(false)},showLog:function(e){let t=[];for(const s of e.matchAll(/(?:<message>(.*?)<[/]message>)/gm)){t.push(s[1])}let s=[];for(const t of e.matchAll(/(?:<severity>(.*?)<[/]severity>)/gm)){switch(t[1]){case"error":s.push(sap.ui.core.Mes+
sageType.Error);break;case"info":s.push(sap.ui.core.MessageType.Information);break;case"success":s.push(sap.ui.core.MessageType.Success);break;case"warning":s.push(sap.ui.core.MessageType.Warning);break;default:s.push(sap.ui.core.MessageType.None);break}+
}for(let e=0;e<t.length;e++){if(t[e]=="Ocorreu uma exceção"){continue}sap.ui.getCore().getMessageManager().addMessages(new sap.ui.core.message.Message({message:t[e],persistent:true,type:s[e]}))}},delay:function(e){return new Promise(t=>setTimeout(t,e))},+
sync_wait:function(e){var t=(new Date).getTime();var s=t;while(s<t+e){s=(new Date).getTime()}}}});                                                                                                                                                             