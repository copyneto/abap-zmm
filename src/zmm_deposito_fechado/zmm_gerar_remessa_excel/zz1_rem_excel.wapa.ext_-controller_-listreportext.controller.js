sap.ui.define(["sap/ui/export/Spreadsheet","sap/ui/export/library","sap/m/Dialog","sap/m/MessageView","sap/m/Bar","sap/m/Button","sap/m/Text","sap/ui/core/IconPool","sap/m/MessageItem","sap/ui/model/json/JSONModel","br/com/trescoracoes/remessadepfechado/+
ext/controller/jszip","br/com/trescoracoes/remessadepfechado/ext/controller/xlsx","sap/m/library"],function(e,t,o,r,a,s,i,n,l,p,c,u,d){"use strict";var g;var m;var f;var y;var h;var b;var v;var T;var M;var E;var D;var x;return{onInit:function(e){g=this;m+
=this.getOwnerComponent();h=new s({icon:n.getIconURI("nav-back"),visible:false,press:function(){f.navigateBack();h.setVisible(false)}});var t=new l({type:"{type}",title:"{message}",activeTitle:"{active}",description:"{description}",subtitle:"{subtitle}",+
counter:"{counter}",groupName:"{group}"});f=new r({showDetailsPageHeader:false,itemSelect:function(){h.setVisible(true)},items:{path:"/",template:t},groupItems:true});y=new o({title:"Mensagens de retorno",resizable:true,content:f,state:"Error",customHead+
er:new a({contentMiddle:[new i({text:"Mensagens de retorno"})],contentLeft:[h],contentRight:[new s({press:function(){y.close()},icon:n.getIconURI("decline"),type:"Reject"})]}),contentHeight:"50%",contentWidth:"28%",verticalScrolling:false})},onUpload_Sim+
bolica:function(e){x=1;if(T==null){T=new o({contentWidth:"300px",resizable:true,type:"Message"});T.setTitle("Carregar arquivo Excel");var t=this.oView.sId+"--responsiveTable";var r=this.byId(t);v=new sap.ui.unified.FileUploader({width:"100%",fileType:["x+
lsx","xls"],typeMissmatch:this.handleTypeMissmatch,change:function(e){},uploadComplete:function(e){g.UploadComplete(e,r)}});M=new sap.m.Button({text:"Carregar",type:"Accept",press:function(e){T.setBusy(true);v.checkFileReadable().then(function(){var e=v.+
FUEl;var t=e.files[0];if(v.getValue()===""){sap.m.MessageToast.show("Favor selecionar um arquivo");T.setBusy(false);return}E.setEnabled(false);g.ExecuteReadExcel(e.files&&e.files[0],m.getModel(),r)},function(e){console.log(e);let t=[];t.push({message:"Er+
ro ao ler excel, favor tentar novamente.",type:"Error"});var o=new p;o.setData(t);f.setModel(o);b.setText("1");b.setIcon(n.getIconURI("message-error"));b.setType("Negative");b.setVisible(true);f.navigateBack();h.setVisible(false);y.open();T.setBusy(false+
);E.setEnabled(true)}).then(function(){v.clear()})}});E=new sap.m.Button({icon:n.getIconURI("decline"),type:"Reject",press:function(){T.close()}});try{var l=false;var c=f.getModel().oData.length;if(c!=0){l=true}}catch(e){}b=new s({icon:n.getIconURI("mess+
age-error"),type:"Negative",text:c,visible:l,press:function(){f.navigateBack();h.setVisible(false);y.open()}});T.addContent(v);T.addButton(b);T.addButton(M);T.setCustomHeader(new a({contentMiddle:[new i({text:"Carregar arquivo Excel"})],contentRight:[E]}+
));T.open()}else{T.open()}},onGeraModelo_Simbolica:function(o){var r=[];r.push({label:"TipoEstoque",property:"tipoestoque",type:t.EdmType.String});r.push({label:"CentroOrigem",property:"centroorigem",type:t.EdmType.String});r.push({label:"DepositoOrigem"+
,property:"Deposito Origem",type:t.EdmType.String});r.push({label:"CentroDestino",property:"centrodestino",type:t.EdmType.String});r.push({label:"DepositoDestino",property:"destinodestino",type:t.EdmType.String});r.push({label:"Material",property:"materi+
al",type:t.EdmType.String});r.push({label:"QtdTransferida",property:"qtdtransferida",type:t.EdmType.String});var a={workbook:{columns:r},dataSource:[""],count:1,fileName:"base_carga_depositofechado_remessa_simbolica.xlsx"};var s=new e(a);s.build().finall+
y(function(){s.destroy()})},onUpload_Transporte:function(e){x=2;if(T==null){T=new o({contentWidth:"300px",resizable:true,type:"Message"});T.setTitle("Carregar arquivo Excel");var t=this.oView.sId+"--responsiveTable";var r=this.byId(t);v=new sap.ui.unifie+
d.FileUploader({width:"100%",fileType:["xlsx","xls"],typeMissmatch:this.handleTypeMissmatch,change:function(e){},uploadComplete:function(e){g.UploadComplete(e,r)}});M=new sap.m.Button({text:"Carregar",type:"Accept",press:function(e){T.setBusy(true);v.che+
ckFileReadable().then(function(){var e=v.FUEl;var t=e.files[0];if(v.getValue()===""){sap.m.MessageToast.show("Favor selecionar um arquivo");T.setBusy(false);return}E.setEnabled(false);g.ExecuteReadExcel(e.files&&e.files[0],m.getModel(),r)},function(e){co+
nsole.log(e);let t=[];t.push({message:"Erro ao ler excel, favor tentar novamente.",type:"Error"});var o=new p;o.setData(t);f.setModel(o);b.setText("1");b.setIcon(n.getIconURI("message-error"));b.setType("Negative");b.setVisible(true);f.navigateBack();h.s+
etVisible(false);y.open();T.setBusy(false);E.setEnabled(true)}).then(function(){v.clear()})}});E=new sap.m.Button({icon:n.getIconURI("decline"),type:"Reject",press:function(){T.close()}});try{var l=false;var c=f.getModel().oData.length;if(c!=0){l=true}}c+
atch(e){}b=new s({icon:n.getIconURI("message-error"),type:"Negative",text:c,visible:l,press:function(){f.navigateBack();h.setVisible(false);y.open()}});T.addContent(v);T.addButton(b);T.addButton(M);T.setCustomHeader(new a({contentMiddle:[new i({text:"Car+
regar arquivo Excel"})],contentRight:[E]}));T.open()}else{T.open()}},onGerarModelo_Transporte:function(o){var r=[];r.push({label:"TipoEstoque",property:"tipoestoque",type:t.EdmType.String});r.push({label:"CentroOrigem",property:"centroorigem",type:t.EdmT+
ype.String});r.push({label:"DepositoOrigem",property:"Deposito Origem",type:t.EdmType.String});r.push({label:"CentroDestino",property:"centrodestino",type:t.EdmType.String});r.push({label:"DepositoDestino",property:"destinodestino",type:t.EdmType.String}+
);r.push({label:"ModalidadeFrete",property:"modalidadefrete",type:t.EdmType.String});r.push({label:"TipoDeExpedicao",property:"tipoexpedicao",type:t.EdmType.String});r.push({label:"CondicaoDeExpedicao",property:"condicaoexpedicao",type:t.EdmType.String})+
;r.push({label:"Transportador",property:"transportador",type:t.EdmType.String});r.push({label:"Motorista",property:"motorista",type:t.EdmType.String});r.push({label:"Veiculo",property:"veiculo",type:t.EdmType.String});r.push({label:"Semireboque1",propert+
y:"semireboque1",type:t.EdmType.String});r.push({label:"Semireboque2",property:"semireboque2",type:t.EdmType.String});r.push({label:"Semireboque3",property:"semireboque3",type:t.EdmType.String});r.push({label:"Material",property:"material",type:t.EdmType+
.String});r.push({label:"QtdTransferida",property:"qtdtransferida",type:t.EdmType.String});var a={workbook:{columns:r},dataSource:[""],count:1,fileName:"base_carga_depositofechado_com_transportadora.xlsx"};var s=new e(a);s.build().finally(function(){s.de+
stroy()})},ExecuteReadExcel:function(e,t,o){var r={};var a=true;if(e&&window.FileReader){if(D==null){D=new FileReader}D.onload=function(e){var t=e.target.result;var o=XLSX.read(t,{type:"binary"});o.SheetNames.forEach(function(e){r=XLSX.utils.sheet_to_row+
_object_array(o.Sheets[e])})};D.onloadend=function(s){if(a){if(!g.validateFields(r)){return}sap.m.MessageToast.show("Carga em processamento.");g.ExecuteActionProcess(r,e,t,o)}};D.onerror=function(e){a=false;let t=[];t.push({message:"Erro ao ler excel, fa+
vor tentar novamente.",type:"Error"});var o=new p;o.setData(t);f.setModel(o);b.setText("1");b.setIcon(n.getIconURI("message-error"));b.setType("Negative");b.setVisible(true);f.navigateBack();h.setVisible(false);y.open();T.setBusy(false);E.setEnabled(true+
)};D.readAsBinaryString(e)}},validateFields:function(e){try{if(e.length==0){throw new UserException("ArquiveInvalid")}if(x==2){e.forEach(e=>{e.TipoEstoque=e.TipoEstoque==null?"":e.TipoEstoque;e.CentroOrigem=e.CentroOrigem==null?"":e.CentroOrigem;e.Deposi+
toOrigem=e.DepositoOrigem==null?"":e.DepositoOrigem;e.CentroDestino=e.CentroDestino==null?"":e.CentroDestino;e.DepositoDestino=e.DepositoDestino==null?"":e.DepositoDestino;e.Material=e.Material==null?"":e.Material;e.QtdTransferida=e.QtdTransferida==null?+
0:e.QtdTransferida;e.ModalidadeFrete=e.ModalidadeFrete==null?"":e.ModalidadeFrete;e.TipoDeExpedicao=e.TipoDeExpedicao==null?"":e.TipoDeExpedicao;e.CondicaoDeExpedicao=e.CondicaoDeExpedicao==null?"":e.CondicaoDeExpedicao;e.Transportador=e.Transportador==n+
ull?"":e.Transportador;e.Motorista=e.Motorista==null?"":e.Motorista;e.Veiculo=e.Veiculo==null?"":e.Veiculo;e.Semireboque1=e.Semireboque1==null?"":e.Semireboque1;e.Semireboque2=e.Semireboque2==null?"":e.Semireboque2;e.Semireboque3=e.Semireboque3==null?"":+
e.Semireboque3})}else{if(x==1){e.forEach(e=>{e.TipoEstoque=e.TipoEstoque==null?"":e.TipoEstoque;e.CentroOrigem=e.CentroOrigem==null?"":e.CentroOrigem;e.DepositoOrigem=e.DepositoOrigem==null?"":e.DepositoOrigem;e.CentroDestino=e.CentroDestino==null?"":e.C+
entroDestino;e.DepositoDestino=e.DepositoDestino==null?"":e.DepositoDestino;e.Material=e.Material==null?"":e.Material;e.QtdTransferida=e.QtdTransferida==null?0:e.QtdTransferida})}}}catch(o){let r=[];if(e.length==0){r.push({message:"Erro ao ler excel, fav+
or utilizar layout do modelo com dados.",type:"Error"})}else{r.push({message:"Erro ao ler excel, favor utilizar layout do modelo.",type:"Error"})}var t=new p;t.setData(r);f.setModel(t);b.setText("1");b.setIcon(n.getIconURI("message-error"));b.setType("Ne+
gative");b.setVisible(true);f.navigateBack();h.setVisible(false);y.open();T.setBusy(false);E.setEnabled(true);return false}return true},ExecuteActionProcess:function(e,t,o,r){var a=e.length;var s=0;try{sap.ui.getCore().getMessageManager().removeAllMessag+
es()}catch(e){}if(x==2){e.forEach(e=>{o.callFunction("/toUploadTransporte",{method:"POST",urlParameters:{Guid:"00000000-0000-0000-0000-000000000000",file_directory:t.name,centro_origem:e.CentroOrigem,tipo_estoque:e.TipoEstoque,tipo_remessa:"2",deposito_o+
rigem:e.DepositoOrigem,centro_destino:e.CentroDestino,deposito_destino:e.DepositoDestino,material:e.Material,qtd_transferencia:e.QtdTransferida,modalidadeFrete:e.ModalidadeFrete,tipo_expedicao:e.TipoDeExpedicao,cond_expedicao:e.CondicaoDeExpedicao,Transp+
ortador:e.Transportador,Motorista:e.Motorista,Veiculo:e.Veiculo,SemiReboque1:e.Semireboque1,SemiReboque2:e.Semireboque2,SemiReboque3:e.Semireboque3},success:function(e,t){s+=+1;g.successActionCall(a,s,r)}.bind(this),error:function(e){s+=+1;g.errorActionC+
all(e,s)}.bind(this),refreshAfterChange:true})})}else{if(x==1){e.forEach(e=>{o.callFunction("/toUploadSimbolica",{method:"POST",urlParameters:{Guid:"00000000-0000-0000-0000-000000000000",file_directory:t.name,centro_origem:e.CentroOrigem,tipo_estoque:e.T+
ipoEstoque,tipo_remessa:"1",deposito_origem:e.DepositoOrigem,centro_destino:e.CentroDestino,deposito_destino:e.DepositoDestino,material:e.Material,qtd_transferencia:e.QtdTransferida},success:function(e,t){s+=+1;g.successActionCall(a,s,r)}.bind(this),erro+
r:function(e){s+=+1;g.errorActionCall(e,s)}.bind(this),refreshAfterChange:true})})}}},successActionCall:function(e,t,o){if(t==1){try{var r=new p;r.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());f.setModel(r);b.setText(sap.ui.ge+
tCore().getMessageManager().getMessageModel().getData().length);if(sap.ui.getCore().getMessageManager().getMessageModel().getData().length==0){let e=new p;let t=[];t.push({message:"Sucesso ao processar dados, porém não foi retornado nenhum dado, carga re+
alizada.",type:"Success"});e.setData(t);f.setModel(e);b.setText("1")}b.setIcon(n.getIconURI("message-success"));b.setType("Success");b.setVisible(true);f.navigateBack();h.setVisible(false);y.open()}catch(e){sap.m.MessageToast.show("Erro ao receber dados +
de retorno do processamento, carga realizada.")}try{T.setBusy(false);E.setEnabled(true);T.close()}catch(e){console.log(e)}}if(e==t){try{if(o){o.getModel().refresh(true)}}catch(e){console.log(e)}}},errorActionCall:function(e,t){if(t==1){try{var o=new p;o.+
setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());f.setModel(o);b.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);try{var r=JSON.parse(e.responseText);if(r.error.code=="005056A509B11EE1B9A8DBD9EA7B+
B778"){let e=[];e.push({message:"Erro ao ler excel, existe(em) campo(os) com dado(os) diferente(es) do tipo solicitado ou modelo utilizado ou vazios/utilizando modelo diferente do solicitado.",type:"Error"});o.setData(e);f.setModel(o);b.setText("1")}}cat+
ch(e){console.log(e)}try{if(sap.ui.getCore().getMessageManager().getMessageModel().getData().length==0){console.log(e);let t=new p;let o=[];o.push({message:"Erro ao processar dados, porém não foi retornado nenhum dado, carga não realizada.",type:"Error"}+
);o.push({message:"Se erro persistir, contacte o suporte.",type:"Information"});t.setData(o);f.setModel(t);b.setText("1")}}catch(e){console.log(e)}b.setIcon(n.getIconURI("message-error"));b.setType("Negative");b.setVisible(true);f.navigateBack();h.setVis+
ible(false);y.open()}catch(e){sap.m.MessageToast.show("Erro ao receber erros retornados do processamento, carga não realizada.")}try{T.setBusy(false);E.setEnabled(true)}catch(e){console.log(e)}}},handleTypeMissmatch:function(e){var t=e.getSource().getFil+
eType();jQuery.each(t,function(e,o){t[e]="*."+o});var o=t.join(", ");sap.m.MessageToast.show("Tipo de arquivo *."+e.getParameter("fileType")+" não é suportado. Escolha um dos tipos a seguir: "+o)},UploadComplete:function(e,t){T.setBusy(false);E.setEnable+
d(true);if(t){t.getModel().refresh(true)}if(e.mParameters.status=="200"||e.mParameters.status=="201"){T.close();sap.m.MessageToast.show("Carga realizada com sucesso.")}else{if(e.mParameters.response){if(e.mParameters.responseRaw.search("<message>")){var +
o=e.mParameters.responseRaw.split("<message>")[1].split("</message>")[0];let t=[];t.push({message:o,type:"Error"});var r=new p;r.setData(t);f.setModel(r);b.setText("1");b.setIcon(n.getIconURI("message-error"));b.setType("Negative");b.setVisible(true);f.n+
avigateBack();h.setVisible(false);y.open();T.setBusy(false);E.setEnabled(true)}else{alert("Return Code: "+e.mParameters.response,"Response","Response")}}}},onGetUrl:function(e){let t=e.getSource().getParent().getParent();let o=t.getSelectedContexts();let+
 r=o[0];let a=r.getProperty();try{sap.ui.getCore().getMessageManager().removeAllMessages()}catch(e){}try{m.getModel().callFunction("/toGetUrl",{method:"POST",urlParameters:{Guid:a.Guid},success:function(e,t){let o=sap.ui.getCore().getMessageManager().get+
MessageModel().getData()[0];var r=d.URLHelper;r.redirect(o.message,true)}.bind(this),error:function(e){sap.m.MessageToast.show(oI18n.getText("errortoReceiverUrl"))}.bind(this),refreshAfterChange:true})}catch(e){g.handlerError(oI18n.getText("errortoReceiv+
erUrl"))}}}});                                                                                                                                                                                                                                                 