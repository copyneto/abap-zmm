sap.ui.define([                                                                                                                                                                                                                                                
    "sap/ui/export/Spreadsheet",                                                                                                                                                                                                                               
    "sap/ui/export/library",                                                                                                                                                                                                                                   
    "sap/m/Dialog",                                                                                                                                                                                                                                            
    "sap/m/MessageView",                                                                                                                                                                                                                                       
    "sap/m/Bar",                                                                                                                                                                                                                                               
    "sap/m/Button",                                                                                                                                                                                                                                            
    "sap/m/Text",                                                                                                                                                                                                                                              
    "sap/ui/core/IconPool",                                                                                                                                                                                                                                    
    "sap/m/MessageItem",                                                                                                                                                                                                                                       
    "sap/ui/model/json/JSONModel",                                                                                                                                                                                                                             
    //bibliotecas necessárias para leitura do excel                                                                                                                                                                                                            
    "br/com/trescoracoes/remessadepfechado/ext/controller/jszip",                                                                                                                                                                                              
    "br/com/trescoracoes/remessadepfechado/ext/controller/xlsx",                                                                                                                                                                                               
    "sap/m/library"                                                                                                                                                                                                                                            
],                                                                                                                                                                                                                                                             
    function (spreadsheet, library, Dialog, MessageView, Bar, Button, Text, IconPool, MessageItem, JSONModel, jszip, xlsx, MobileLibrary) {                                                                                                                    
        "use strict";                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        //Variáveis de contexto                                                                                                                                                                                                                                
        var oThisContext;                                                                                                                                                                                                                                      
        var oViewComponent;                                                                                                                                                                                                                                    
        //Variáveis de Mensagens de retorno                                                                                                                                                                                                                    
        var oMessageView;                                                                                                                                                                                                                                      
        var oMessageDialog;                                                                                                                                                                                                                                    
        var oBackButtonMessage;                                                                                                                                                                                                                                
        var oBtnMessages;                                                                                                                                                                                                                                      
        //Variáveis de diálogo upload                                                                                                                                                                                                                          
        var oFileUploader;                                                                                                                                                                                                                                     
        var oUploadDialog;                                                                                                                                                                                                                                     
        var oBtnUpload;                                                                                                                                                                                                                                        
        var oBtnClose;                                                                                                                                                                                                                                         
        //Variáveis da leitura excel                                                                                                                                                                                                                           
        var oReaderExcel;                                                                                                                                                                                                                                      
        // 1 = Simbolica 2 = Transporte                                                                                                                                                                                                                        
        var oTipoPlanilha;                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        return {                                                                                                                                                                                                                                               
            onInit: function (oEvent) {                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                oThisContext = this;                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                oViewComponent = this.getOwnerComponent();// ou this.getView();                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                oBackButtonMessage = new Button({                                                                                                                                                                                                              
                    icon: IconPool.getIconURI("nav-back"),                                                                                                                                                                                                     
                    visible: false,                                                                                                                                                                                                                            
                    press: function () {                                                                                                                                                                                                                       
                        oMessageView.navigateBack();                                                                                                                                                                                                           
                        oBackButtonMessage.setVisible(false);                                                                                                                                                                                                  
                    }                                                                                                                                                                                                                                          
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                var oMessageTemplate = new MessageItem({                                                                                                                                                                                                       
                    type: '{type}',                                                                                                                                                                                                                            
                    title: '{message}',                                                                                                                                                                                                                        
                    activeTitle: "{active}",                                                                                                                                                                                                                   
                    description: '{description}',                                                                                                                                                                                                              
                    subtitle: '{subtitle}',                                                                                                                                                                                                                    
                    counter: '{counter}',                                                                                                                                                                                                                      
                    groupName: '{group}'                                                                                                                                                                                                                       
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                oMessageView = new MessageView({                                                                                                                                                                                                               
                    showDetailsPageHeader: false,                                                                                                                                                                                                              
                    itemSelect: function () {                                                                                                                                                                                                                  
                        oBackButtonMessage.setVisible(true);                                                                                                                                                                                                   
                    },                                                                                                                                                                                                                                         
                    items: {                                                                                                                                                                                                                                   
                        path: "/",                                                                                                                                                                                                                             
                        template: oMessageTemplate                                                                                                                                                                                                             
                    },                                                                                                                                                                                                                                         
                    groupItems: true                                                                                                                                                                                                                           
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                oMessageDialog = new Dialog({                                                                                                                                                                                                                  
                    title: "Mensagens de retorno",                                                                                                                                                                                                             
                    resizable: true,                                                                                                                                                                                                                           
                    content: oMessageView,                                                                                                                                                                                                                     
                    state: 'Error',                                                                                                                                                                                                                            
                    customHeader: new Bar({                                                                                                                                                                                                                    
                        contentMiddle: [                                                                                                                                                                                                                       
                            new Text({ text: "Mensagens de retorno" })                                                                                                                                                                                         
                        ],                                                                                                                                                                                                                                     
                        contentLeft: [                                                                                                                                                                                                                         
                            oBackButtonMessage                                                                                                                                                                                                                 
                        ],                                                                                                                                                                                                                                     
                        contentRight: [                                                                                                                                                                                                                        
                            new Button({                                                                                                                                                                                                                       
                                press: function () {                                                                                                                                                                                                           
                                    oMessageDialog.close();                                                                                                                                                                                                    
                                },                                                                                                                                                                                                                             
                                icon: IconPool.getIconURI("decline"),                                                                                                                                                                                          
                                type: 'Reject'                                                                                                                                                                                                                 
                            })                                                                                                                                                                                                                                 
                        ]                                                                                                                                                                                                                                      
                    }),                                                                                                                                                                                                                                        
                    contentHeight: "50%",                                                                                                                                                                                                                      
                    contentWidth: "28%",                                                                                                                                                                                                                       
                    verticalScrolling: false                                                                                                                                                                                                                   
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
            onUpload_Simbolica: function (oEvent) {                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                oTipoPlanilha = 1;                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                if (oUploadDialog == null) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    //Cria Diálogo dinâmico (pop-up)                                                                                                                                                                                                           
                    oUploadDialog = new Dialog({                                                                                                                                                                                                               
                        contentWidth: "300px",                                                                                                                                                                                                                 
                        resizable: true,                                                                                                                                                                                                                       
                        type: "Message"                                                                                                                                                                                                                        
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    oUploadDialog.setTitle("Carregar arquivo Excel");                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    // Tabela do listreport                                                                                                                                                                                                                    
                    var sId = this.oView.sId + '--responsiveTable';                                                                                                                                                                                            
                    var oTable = this.byId(sId);                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    //Prepara o responsável pela carga do arquivo                                                                                                                                                                                              
                    oFileUploader = new sap.ui.unified.FileUploader({                                                                                                                                                                                          
                        width: "100%",                                                                                                                                                                                                                         
                        fileType: ["xlsx", "xls"],                                                                                                                                                                                                             
                        typeMissmatch: this.handleTypeMissmatch,                                                                                                                                                                                               
                        change: function (oEvent) { },                                                                                                                                                                                                         
                        uploadComplete: function (oEvent) { oThisContext.UploadComplete(oEvent, oTable) }                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    /* ===================================================================&nbsp;                                                                                                                                                               
                    Cria botão para a carga do arquivo                                                                                                                                                                                                         
                    =================================================================== */                                                                                                                                                                     
                    oBtnUpload = new sap.m.Button({                                                                                                                                                                                                            
                        text: 'Carregar',                                                                                                                                                                                                                      
                        type: 'Accept',                                                                                                                                                                                                                        
                        press: function (event) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            // Inativar tela - esperando                                                                                                                                                                                                       
                            oUploadDialog.setBusy(true);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                            oFileUploader.checkFileReadable().then(function () {                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                // Verifica se arquivo foi informado                                                                                                                                                                                           
                                var domRef = oFileUploader.FUEl;//oFileUploader.getFocusDomRef();                                                                                                                                                              
                                var file = domRef.files[0];                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                if (oFileUploader.getValue() === '') {                                                                                                                                                                                         
                                    sap.m.MessageToast.show("Favor selecionar um arquivo");                                                                                                                                                                    
                                    oUploadDialog.setBusy(false);                                                                                                                                                                                              
                                    return;                                                                                                                                                                                                                    
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                //Bloqueio botão de fechamento do diálogo                                                                                                                                                                                      
                                oBtnClose.setEnabled(false);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                //Action rap gerenciável                                                                                                                                                                                                       
                                //oThisContext.ExecuteReadExcel(domRef.files && domRef.files[0], oViewComponent.getModel(), oTable);                                                                                                                           
                                                                                                                                                                                                                                                               
                                //Action rap não gerenciável                                                                                                                                                                                                   
                                oThisContext.ExecuteReadExcel(domRef.files && domRef.files[0], oViewComponent.getModel(), oTable);                                                                                                                             
                                                                                                                                                                                                                                                               
                                //Upload do arquivo para segw                                                                                                                                                                                                  
                                //oThisContext.PrepareUpload(domRef.files[0], oViewComponent.getModel("uploadModel"));                                                                                                                                         
                                                                                                                                                                                                                                                               
                                //oThisContext.ExecuteUpload(domRef.files[0]);                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                            }, function (error) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                console.log(error);                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                let sMessage = [];                                                                                                                                                                                                             
                                sMessage.push({                                                                                                                                                                                                                
                                    message: "Erro ao ler excel, favor tentar novamente.",                                                                                                                                                                     
                                    type: "Error"                                                                                                                                                                                                              
                                });                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                var oModelMessageManagerError = new JSONModel();                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                oModelMessageManagerError.setData(sMessage);                                                                                                                                                                                   
                                oMessageView.setModel(oModelMessageManagerError);                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                oBtnMessages.setText("1");                                                                                                                                                                                                     
                                oBtnMessages.setIcon(IconPool.getIconURI("message-error"));                                                                                                                                                                    
                                oBtnMessages.setType("Negative");                                                                                                                                                                                              
                                oBtnMessages.setVisible(true);                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                oMessageView.navigateBack();                                                                                                                                                                                                   
                                oBackButtonMessage.setVisible(false);                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                oMessageDialog.open();                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                oUploadDialog.setBusy(false);                                                                                                                                                                                                  
                                oBtnClose.setEnabled(true);                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                            }).then(function () {                                                                                                                                                                                                              
                                oFileUploader.clear();                                                                                                                                                                                                         
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    //Cria botão de fechar                                                                                                                                                                                                                     
                    oBtnClose = new sap.m.Button({                                                                                                                                                                                                             
                        icon: IconPool.getIconURI("decline"),                                                                                                                                                                                                  
                        type: 'Reject',                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        press: function () {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            oUploadDialog.close();                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var vVisible = false;                                                                                                                                                                                                                  
                        var vText = oMessageView.getModel().oData.length;                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        if (vText != 0) {                                                                                                                                                                                                                      
                            vVisible = true;                                                                                                                                                                                                                   
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                        //Não exibir                                                                                                                                                                                                                           
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oBtnMessages = new Button({                                                                                                                                                                                                                
                        icon: IconPool.getIconURI("message-error"),                                                                                                                                                                                            
                        type: "Negative",                                                                                                                                                                                                                      
                        text: vText,                                                                                                                                                                                                                           
                        visible: vVisible,                                                                                                                                                                                                                     
                        press: function () {                                                                                                                                                                                                                   
                            oMessageView.navigateBack();                                                                                                                                                                                                       
                            oBackButtonMessage.setVisible(false);                                                                                                                                                                                              
                            oMessageDialog.open();                                                                                                                                                                                                             
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    //Chama diálogo com a lógica de carga&nbsp;                                                                                                                                                                                                
                    oUploadDialog.addContent(oFileUploader);                                                                                                                                                                                                   
                    oUploadDialog.addButton(oBtnMessages);                                                                                                                                                                                                     
                    oUploadDialog.addButton(oBtnUpload);                                                                                                                                                                                                       
                    oUploadDialog.setCustomHeader(new Bar({                                                                                                                                                                                                    
                        contentMiddle: [                                                                                                                                                                                                                       
                            new Text({ text: "Carregar arquivo Excel" })                                                                                                                                                                                       
                        ],                                                                                                                                                                                                                                     
                        contentRight: [oBtnClose]                                                                                                                                                                                                              
                    }));                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    oUploadDialog.open();                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                } else {                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    oUploadDialog.open();                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
            onGeraModelo_Simbolica: function (oEvent) {                                                                                                                                                                                                        
                /* ===================================================================&nbsp;                                                                                                                                                                   
                           Monta layout de colunas                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var aCols = [];                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'TipoEstoque',                                                                                                                                                                                                                      
                    property: 'tipoestoque',                                                                                                                                                                                                                   
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'CentroOrigem',                                                                                                                                                                                                                     
                    property: 'centroorigem',                                                                                                                                                                                                                  
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'DepositoOrigem',                                                                                                                                                                                                                   
                    property: 'Deposito Origem',                                                                                                                                                                                                               
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'CentroDestino',                                                                                                                                                                                                                    
                    property: 'centrodestino',                                                                                                                                                                                                                 
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'DepositoDestino',                                                                                                                                                                                                                  
                    property: 'destinodestino',                                                                                                                                                                                                                
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Material',                                                                                                                                                                                                                         
                    property: 'material',                                                                                                                                                                                                                      
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'QtdTransferida',                                                                                                                                                                                                                   
                    property: 'qtdtransferida',                                                                                                                                                                                                                
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                        Prepara configurações                                                                                                                                                                                                                  
                =================================================================== */                                                                                                                                                                         
                var oSettings = {                                                                                                                                                                                                                              
                    workbook: { columns: aCols },                                                                                                                                                                                                              
                    dataSource: [''],                                                                                                                                                                                                                          
                    count: 1,                                                                                                                                                                                                                                  
                    fileName: 'base_carga_depositofechado_remessa_simbolica.xlsx'                                                                                                                                                                              
                };                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria planilha&nbsp;                                                                                                                                                                                                                            
                =================================================================== */                                                                                                                                                                         
                var oSheet = new spreadsheet(oSettings);                                                                                                                                                                                                       
                oSheet.build().finally(function () {                                                                                                                                                                                                           
                    oSheet.destroy();                                                                                                                                                                                                                          
                })                                                                                                                                                                                                                                             
            },                                                                                                                                                                                                                                                 
            onUpload_Transporte: function (oEvent) {                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                oTipoPlanilha = 2;                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                if (oUploadDialog == null) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    //Cria Diálogo dinâmico (pop-up)                                                                                                                                                                                                           
                    oUploadDialog = new Dialog({                                                                                                                                                                                                               
                        contentWidth: "300px",                                                                                                                                                                                                                 
                        resizable: true,                                                                                                                                                                                                                       
                        type: "Message"                                                                                                                                                                                                                        
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    oUploadDialog.setTitle("Carregar arquivo Excel");                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    // Tabela do listreport                                                                                                                                                                                                                    
                    var sId = this.oView.sId + '--responsiveTable';                                                                                                                                                                                            
                    var oTable = this.byId(sId);                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    //Prepara o responsável pela carga do arquivo                                                                                                                                                                                              
                    oFileUploader = new sap.ui.unified.FileUploader({                                                                                                                                                                                          
                        width: "100%",                                                                                                                                                                                                                         
                        fileType: ["xlsx", "xls"],                                                                                                                                                                                                             
                        typeMissmatch: this.handleTypeMissmatch,                                                                                                                                                                                               
                        change: function (oEvent) { },                                                                                                                                                                                                         
                        uploadComplete: function (oEvent) { oThisContext.UploadComplete(oEvent, oTable) }                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    /* ===================================================================&nbsp;                                                                                                                                                               
                    Cria botão para a carga do arquivo                                                                                                                                                                                                         
                    =================================================================== */                                                                                                                                                                     
                    oBtnUpload = new sap.m.Button({                                                                                                                                                                                                            
                        text: 'Carregar',                                                                                                                                                                                                                      
                        type: 'Accept',                                                                                                                                                                                                                        
                        press: function (event) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            // Inativar tela - esperando                                                                                                                                                                                                       
                            oUploadDialog.setBusy(true);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                            oFileUploader.checkFileReadable().then(function () {                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                // Verifica se arquivo foi informado                                                                                                                                                                                           
                                var domRef = oFileUploader.FUEl;//oFileUploader.getFocusDomRef();                                                                                                                                                              
                                var file = domRef.files[0];                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                                if (oFileUploader.getValue() === '') {                                                                                                                                                                                         
                                    sap.m.MessageToast.show("Favor selecionar um arquivo");                                                                                                                                                                    
                                    oUploadDialog.setBusy(false);                                                                                                                                                                                              
                                    return;                                                                                                                                                                                                                    
                                }                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                //Bloqueio botão de fechamento do diálogo                                                                                                                                                                                      
                                oBtnClose.setEnabled(false);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                //Action rap gerenciável                                                                                                                                                                                                       
                                //oThisContext.ExecuteReadExcel(domRef.files && domRef.files[0], oViewComponent.getModel(), oTable);                                                                                                                           
                                                                                                                                                                                                                                                               
                                //Action rap não gerenciável                                                                                                                                                                                                   
                                oThisContext.ExecuteReadExcel(domRef.files && domRef.files[0], oViewComponent.getModel(), oTable);                                                                                                                             
                                                                                                                                                                                                                                                               
                                //Upload do arquivo para segw                                                                                                                                                                                                  
                                //oThisContext.PrepareUpload(domRef.files[0], oViewComponent.getModel("uploadModel"));                                                                                                                                         
                                                                                                                                                                                                                                                               
                                //oThisContext.ExecuteUpload(domRef.files[0]);                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                            }, function (error) {                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                console.log(error);                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                let sMessage = [];                                                                                                                                                                                                             
                                sMessage.push({                                                                                                                                                                                                                
                                    message: "Erro ao ler excel, favor tentar novamente.",                                                                                                                                                                     
                                    type: "Error"                                                                                                                                                                                                              
                                });                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                var oModelMessageManagerError = new JSONModel();                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                oModelMessageManagerError.setData(sMessage);                                                                                                                                                                                   
                                oMessageView.setModel(oModelMessageManagerError);                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                oBtnMessages.setText("1");                                                                                                                                                                                                     
                                oBtnMessages.setIcon(IconPool.getIconURI("message-error"));                                                                                                                                                                    
                                oBtnMessages.setType("Negative");                                                                                                                                                                                              
                                oBtnMessages.setVisible(true);                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                oMessageView.navigateBack();                                                                                                                                                                                                   
                                oBackButtonMessage.setVisible(false);                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                oMessageDialog.open();                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                oUploadDialog.setBusy(false);                                                                                                                                                                                                  
                                oBtnClose.setEnabled(true);                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                            }).then(function () {                                                                                                                                                                                                              
                                oFileUploader.clear();                                                                                                                                                                                                         
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    //Cria botão de fechar                                                                                                                                                                                                                     
                    oBtnClose = new sap.m.Button({                                                                                                                                                                                                             
                        icon: IconPool.getIconURI("decline"),                                                                                                                                                                                                  
                        type: 'Reject',                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        press: function () {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            oUploadDialog.close();                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var vVisible = false;                                                                                                                                                                                                                  
                        var vText = oMessageView.getModel().oData.length;                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        if (vText != 0) {                                                                                                                                                                                                                      
                            vVisible = true;                                                                                                                                                                                                                   
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                        //Não exibir                                                                                                                                                                                                                           
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oBtnMessages = new Button({                                                                                                                                                                                                                
                        icon: IconPool.getIconURI("message-error"),                                                                                                                                                                                            
                        type: "Negative",                                                                                                                                                                                                                      
                        text: vText,                                                                                                                                                                                                                           
                        visible: vVisible,                                                                                                                                                                                                                     
                        press: function () {                                                                                                                                                                                                                   
                            oMessageView.navigateBack();                                                                                                                                                                                                       
                            oBackButtonMessage.setVisible(false);                                                                                                                                                                                              
                            oMessageDialog.open();                                                                                                                                                                                                             
                        }                                                                                                                                                                                                                                      
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    //Chama diálogo com a lógica de carga&nbsp;                                                                                                                                                                                                
                    oUploadDialog.addContent(oFileUploader);                                                                                                                                                                                                   
                    oUploadDialog.addButton(oBtnMessages);                                                                                                                                                                                                     
                    oUploadDialog.addButton(oBtnUpload);                                                                                                                                                                                                       
                    oUploadDialog.setCustomHeader(new Bar({                                                                                                                                                                                                    
                        contentMiddle: [                                                                                                                                                                                                                       
                            new Text({ text: "Carregar arquivo Excel" })                                                                                                                                                                                       
                        ],                                                                                                                                                                                                                                     
                        contentRight: [oBtnClose]                                                                                                                                                                                                              
                    }));                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    oUploadDialog.open();                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                } else {                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    oUploadDialog.open();                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
            onGerarModelo_Transporte: function (oEvent) {                                                                                                                                                                                                      
                /* ===================================================================&nbsp;                                                                                                                                                                   
                           Monta layout de colunas                                                                                                                                                                                                             
                =================================================================== */                                                                                                                                                                         
                var aCols = [];                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'TipoEstoque',                                                                                                                                                                                                                      
                    property: 'tipoestoque',                                                                                                                                                                                                                   
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'CentroOrigem',                                                                                                                                                                                                                     
                    property: 'centroorigem',                                                                                                                                                                                                                  
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'DepositoOrigem',                                                                                                                                                                                                                   
                    property: 'Deposito Origem',                                                                                                                                                                                                               
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'CentroDestino',                                                                                                                                                                                                                    
                    property: 'centrodestino',                                                                                                                                                                                                                 
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'DepositoDestino',                                                                                                                                                                                                                  
                    property: 'destinodestino',                                                                                                                                                                                                                
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'ModalidadeFrete',                                                                                                                                                                                                                  
                    property: 'modalidadefrete',                                                                                                                                                                                                               
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'TipoDeExpedicao',                                                                                                                                                                                                                  
                    property: 'tipoexpedicao',                                                                                                                                                                                                                 
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'CondicaoDeExpedicao',                                                                                                                                                                                                              
                    property: 'condicaoexpedicao',                                                                                                                                                                                                             
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Transportador',                                                                                                                                                                                                                    
                    property: 'transportador',                                                                                                                                                                                                                 
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Motorista',                                                                                                                                                                                                                        
                    property: 'motorista',                                                                                                                                                                                                                     
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Veiculo',                                                                                                                                                                                                                          
                    property: 'veiculo',                                                                                                                                                                                                                       
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Semireboque1',                                                                                                                                                                                                                     
                    property: 'semireboque1',                                                                                                                                                                                                                  
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Semireboque2',                                                                                                                                                                                                                     
                    property: 'semireboque2',                                                                                                                                                                                                                  
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Semireboque3',                                                                                                                                                                                                                     
                    property: 'semireboque3',                                                                                                                                                                                                                  
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'Material',                                                                                                                                                                                                                         
                    property: 'material',                                                                                                                                                                                                                      
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                aCols.push({                                                                                                                                                                                                                                   
                    label: 'QtdTransferida',                                                                                                                                                                                                                   
                    property: 'qtdtransferida',                                                                                                                                                                                                                
                    type: library.EdmType.String                                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                        Prepara configurações                                                                                                                                                                                                                  
                =================================================================== */                                                                                                                                                                         
                var oSettings = {                                                                                                                                                                                                                              
                    workbook: { columns: aCols },                                                                                                                                                                                                              
                    dataSource: [''],                                                                                                                                                                                                                          
                    count: 1,                                                                                                                                                                                                                                  
                    fileName: 'base_carga_depositofechado_com_transportadora.xlsx'                                                                                                                                                                             
                };                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Cria planilha&nbsp;                                                                                                                                                                                                                            
                =================================================================== */                                                                                                                                                                         
                var oSheet = new spreadsheet(oSettings);                                                                                                                                                                                                       
                oSheet.build().finally(function () {                                                                                                                                                                                                           
                    oSheet.destroy();                                                                                                                                                                                                                          
                })                                                                                                                                                                                                                                             
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            ExecuteReadExcel: function (file, oModel, oTable) {                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                var excelData = {};                                                                                                                                                                                                                            
                var Success = true;                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                if (file && window.FileReader) {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    if (oReaderExcel == null) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        oReaderExcel = new FileReader();                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oReaderExcel.onload = function (e) {                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        var data = e.target.result;                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                        var workbook = XLSX.read(data, {                                                                                                                                                                                                       
                            type: 'binary'                                                                                                                                                                                                                     
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        workbook.SheetNames.forEach(function (sheetName) {                                                                                                                                                                                     
                            // Passagem da linha para o array                                                                                                                                                                                                  
                            excelData = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    };                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oReaderExcel.onloadend = function (e) {                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        if (Success) {                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                            //Validação/Preenchimento de campo com vazio para não gerar erro na passagem dos dados                                                                                                                                             
                            if (!oThisContext.validateFields(excelData)) {                                                                                                                                                                                     
                                return;                                                                                                                                                                                                                        
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            sap.m.MessageToast.show("Carga em processamento.");                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                            //Executa chamadas da ação com os dados                                                                                                                                                                                            
                            oThisContext.ExecuteActionProcess(excelData, file, oModel, oTable);                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    };                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oReaderExcel.onerror = function (ex) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        Success = false;                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        let sMessage = [];                                                                                                                                                                                                                     
                        sMessage.push({                                                                                                                                                                                                                        
                            message: "Erro ao ler excel, favor tentar novamente.",                                                                                                                                                                             
                            type: "Error"                                                                                                                                                                                                                      
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        var oModelMessageManagerError = new JSONModel();                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                        oModelMessageManagerError.setData(sMessage);                                                                                                                                                                                           
                        oMessageView.setModel(oModelMessageManagerError);                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        oBtnMessages.setText("1");                                                                                                                                                                                                             
                        oBtnMessages.setIcon(IconPool.getIconURI("message-error"));                                                                                                                                                                            
                        oBtnMessages.setType("Negative");                                                                                                                                                                                                      
                        oBtnMessages.setVisible(true);                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        oMessageView.navigateBack();                                                                                                                                                                                                           
                        oBackButtonMessage.setVisible(false);                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        oMessageDialog.open();                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                        oUploadDialog.setBusy(false);                                                                                                                                                                                                          
                        oBtnClose.setEnabled(true);                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    };                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oReaderExcel.readAsBinaryString(file);                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            validateFields: function (excelData) {                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (excelData.length == 0) {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        throw new UserException("ArquiveInvalid");                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    if (oTipoPlanilha == 2) //Transporte                                                                                                                                                                                                       
                    {                                                                                                                                                                                                                                          
                        excelData.forEach(e => {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            //"Preeche" campo para evitar erro na chamada, validação será feita no backend                                                                                                                                                     
                            e.TipoEstoque = ((e.TipoEstoque == null) ? '' : e.TipoEstoque);                                                                                                                                                                    
                            e.CentroOrigem = ((e.CentroOrigem == null) ? '' : e.CentroOrigem);                                                                                                                                                                 
                            e.DepositoOrigem = ((e.DepositoOrigem == null) ? '' : e.DepositoOrigem);                                                                                                                                                           
                            e.CentroDestino = ((e.CentroDestino == null) ? '' : e.CentroDestino);                                                                                                                                                              
                            e.DepositoDestino = ((e.DepositoDestino == null) ? '' : e.DepositoDestino);                                                                                                                                                        
                            e.Material = ((e.Material == null) ? '' : e.Material);                                                                                                                                                                             
                            e.QtdTransferida = ((e.QtdTransferida == null) ? 0 : e.QtdTransferida);                                                                                                                                                            
                            e.ModalidadeFrete = ((e.ModalidadeFrete == null) ? '' : e.ModalidadeFrete);                                                                                                                                                        
                            e.TipoDeExpedicao = ((e.TipoDeExpedicao == null) ? '' : e.TipoDeExpedicao);                                                                                                                                                        
                            e.CondicaoDeExpedicao = ((e.CondicaoDeExpedicao == null) ? '' : e.CondicaoDeExpedicao);                                                                                                                                            
                            e.Transportador = ((e.Transportador == null) ? '' : e.Transportador);                                                                                                                                                              
                            e.Motorista = ((e.Motorista == null) ? '' : e.Motorista);                                                                                                                                                                          
                            e.Veiculo = ((e.Veiculo == null) ? '' : e.Veiculo);                                                                                                                                                                                
                            e.Semireboque1 = ((e.Semireboque1 == null) ? '' : e.Semireboque1);                                                                                                                                                                 
                            e.Semireboque2 = ((e.Semireboque2 == null) ? '' : e.Semireboque2);                                                                                                                                                                 
                            e.Semireboque3 = ((e.Semireboque3 == null) ? '' : e.Semireboque3);                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                    } else {                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        if (oTipoPlanilha == 1) // Simbolica                                                                                                                                                                                                   
                        {                                                                                                                                                                                                                                      
                            excelData.forEach(e => {                                                                                                                                                                                                           
                                //"Preeche" campo para evitar erro na chamada, validação será feita no backend                                                                                                                                                 
                                e.TipoEstoque = ((e.TipoEstoque == null) ? '' : e.TipoEstoque);                                                                                                                                                                
                                e.CentroOrigem = ((e.CentroOrigem == null) ? '' : e.CentroOrigem);                                                                                                                                                             
                                e.DepositoOrigem = ((e.DepositoOrigem == null) ? '' : e.DepositoOrigem);                                                                                                                                                       
                                e.CentroDestino = ((e.CentroDestino == null) ? '' : e.CentroDestino);                                                                                                                                                          
                                e.DepositoDestino = ((e.DepositoDestino == null) ? '' : e.DepositoDestino);                                                                                                                                                    
                                e.Material = ((e.Material == null) ? '' : e.Material);                                                                                                                                                                         
                                e.QtdTransferida = ((e.QtdTransferida == null) ? 0 : e.QtdTransferida);                                                                                                                                                        
                            });                                                                                                                                                                                                                                
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    let sMessage = [];                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    if (excelData.length == 0) {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        sMessage.push({                                                                                                                                                                                                                        
                            message: "Erro ao ler excel, favor utilizar layout do modelo com dados.",                                                                                                                                                          
                            type: "Error"                                                                                                                                                                                                                      
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    } else {                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        sMessage.push({                                                                                                                                                                                                                        
                            message: "Erro ao ler excel, favor utilizar layout do modelo.",                                                                                                                                                                    
                            type: "Error"                                                                                                                                                                                                                      
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    var oModelMessageManagerError = new JSONModel();                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    oModelMessageManagerError.setData(sMessage);                                                                                                                                                                                               
                    oMessageView.setModel(oModelMessageManagerError);                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oBtnMessages.setText("1");                                                                                                                                                                                                                 
                    oBtnMessages.setIcon(IconPool.getIconURI("message-error"));                                                                                                                                                                                
                    oBtnMessages.setType("Negative");                                                                                                                                                                                                          
                    oBtnMessages.setVisible(true);                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    oMessageView.navigateBack();                                                                                                                                                                                                               
                    oBackButtonMessage.setVisible(false);                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    oMessageDialog.open();                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                    oUploadDialog.setBusy(false);                                                                                                                                                                                                              
                    oBtnClose.setEnabled(true);                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    return false;                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                return true;                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            ExecuteActionProcess: function (excelData, file, oModel, oTable) {                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                //Após leitura do arquivo realiza validações e execução da action                                                                                                                                                                              
                var vQuantity = excelData.length;                                                                                                                                                                                                              
                var vCount = 0;                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                // Remove mensagens do processo                                                                                                                                                                                                                
                try {                                                                                                                                                                                                                                          
                    sap.ui.getCore().getMessageManager().removeAllMessages();                                                                                                                                                                                  
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                if (oTipoPlanilha == 2) {                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    excelData.forEach(e => {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        oModel.callFunction("/toUploadTransporte",                                                                                                                                                                                             
                            {                                                                                                                                                                                                                                  
                                method: "POST",                                                                                                                                                                                                                
                                urlParameters: {                                                                                                                                                                                                               
                                    "Guid": '00000000-0000-0000-0000-000000000000',                                                                                                                                                                            
                                    "file_directory": file.name,                                                                                                                                                                                               
                                    "centro_origem": e.CentroOrigem,                                                                                                                                                                                           
                                    "tipo_estoque": e.TipoEstoque,                                                                                                                                                                                             
                                    "tipo_remessa": '2', // Com Transporte                                                                                                                                                                                     
                                    "deposito_origem": e.DepositoOrigem,                                                                                                                                                                                       
                                    "centro_destino": e.CentroDestino,                                                                                                                                                                                         
                                    "deposito_destino": e.DepositoDestino,                                                                                                                                                                                     
                                    "material": e.Material,                                                                                                                                                                                                    
                                    "qtd_transferencia": e.QtdTransferida,                                                                                                                                                                                     
                                    "modalidadeFrete": e.ModalidadeFrete,                                                                                                                                                                                      
                                    "tipo_expedicao": e.TipoDeExpedicao,                                                                                                                                                                                       
                                    "cond_expedicao": e.CondicaoDeExpedicao,                                                                                                                                                                                   
                                    "Transportador": e.Transportador,                                                                                                                                                                                          
                                    "Motorista": e.Motorista,                                                                                                                                                                                                  
                                    "Veiculo": e.Veiculo,                                                                                                                                                                                                      
                                    "SemiReboque1": e.Semireboque1,                                                                                                                                                                                            
                                    "SemiReboque2": e.Semireboque2,                                                                                                                                                                                            
                                    "SemiReboque3": e.Semireboque3                                                                                                                                                                                             
                                },                                                                                                                                                                                                                             
                                success: function (oData, response) {                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                    vCount += + 1;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                    oThisContext.successActionCall(vQuantity, vCount, oTable);                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                }.bind(this),                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                                error: function (oError) {                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                    vCount += + 1;                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                    oThisContext.errorActionCall(oError, vCount);                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                }.bind(this),                                                                                                                                                                                                                  
                                refreshAfterChange: true                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                else {                                                                                                                                                                                                                                         
                    if (oTipoPlanilha == 1) //Simbolica                                                                                                                                                                                                        
                    {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                        excelData.forEach(e => {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                            oModel.callFunction("/toUploadSimbolica",                                                                                                                                                                                          
                                {                                                                                                                                                                                                                              
                                    method: "POST",                                                                                                                                                                                                            
                                    urlParameters: {                                                                                                                                                                                                           
                                        "Guid": '00000000-0000-0000-0000-000000000000',                                                                                                                                                                        
                                        "file_directory": file.name,                                                                                                                                                                                           
                                        "centro_origem": e.CentroOrigem,                                                                                                                                                                                       
                                        "tipo_estoque": e.TipoEstoque,                                                                                                                                                                                         
                                        "tipo_remessa": '1', // Simbolica                                                                                                                                                                                      
                                        "deposito_origem": e.DepositoOrigem,                                                                                                                                                                                   
                                        "centro_destino": e.CentroDestino,                                                                                                                                                                                     
                                        "deposito_destino": e.DepositoDestino,                                                                                                                                                                                 
                                        "material": e.Material,                                                                                                                                                                                                
                                        "qtd_transferencia": e.QtdTransferida                                                                                                                                                                                  
                                    },                                                                                                                                                                                                                         
                                    success: function (oData, response) {                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                                        vCount += + 1;                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                        oThisContext.successActionCall(vQuantity, vCount, oTable);                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                    }.bind(this),                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                    error: function (oError) {                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                        vCount += + 1;                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                        oThisContext.errorActionCall(oError, vCount);                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                    }.bind(this),                                                                                                                                                                                                              
                                    refreshAfterChange: true                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                });                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            successActionCall: function (vQuantity, vCount, oTable) {                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                if (vCount == 1) {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        //Dados de mensagens retornadas do backend                                                                                                                                                                                             
                        var oModelMessageManager = new JSONModel();                                                                                                                                                                                            
                        oModelMessageManager.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());                                                                                                                                        
                        oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                           
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                               
                        oBtnMessages.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);                                                                                                                                         
                                                                                                                                                                                                                                                               
                        if (sap.ui.getCore().getMessageManager().getMessageModel().getData().length == 0) {                                                                                                                                                    
                                                                                                                                                                                                                                                               
                            let oModelMessageManager = new JSONModel();                                                                                                                                                                                        
                            let sMessage = [];                                                                                                                                                                                                                 
                            sMessage.push({                                                                                                                                                                                                                    
                                message: "Sucesso ao processar dados, porém não foi retornado nenhum dado, carga realizada.",                                                                                                                                  
                                type: "Success"                                                                                                                                                                                                                
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                            oModelMessageManager.setData(sMessage);                                                                                                                                                                                            
                            oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                            oBtnMessages.setText("1");                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        oBtnMessages.setIcon(IconPool.getIconURI("message-success"));                                                                                                                                                                          
                        oBtnMessages.setType("Success");                                                                                                                                                                                                       
                        oBtnMessages.setVisible(true);                                                                                                                                                                                                         
                        oMessageView.navigateBack();                                                                                                                                                                                                           
                        oBackButtonMessage.setVisible(false);                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        oMessageDialog.open();                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                        sap.m.MessageToast.show("Erro ao receber dados de retorno do processamento, carga realizada.");                                                                                                                                        
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        oUploadDialog.setBusy(false);                                                                                                                                                                                                          
                        oBtnClose.setEnabled(true);                                                                                                                                                                                                            
                        oUploadDialog.close();                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                        console.log(error);                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                if (vQuantity == vCount) {                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        if (oTable) {                                                                                                                                                                                                                          
                            oTable.getModel().refresh(true);                                                                                                                                                                                                   
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                        console.log(error);                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            errorActionCall: function (oError, vCount) {                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                if (vCount == 1) {                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var oModelMessageManager = new JSONModel();                                                                                                                                                                                            
                        oModelMessageManager.setData(sap.ui.getCore().getMessageManager().getMessageModel().getData());                                                                                                                                        
                        oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                        oBtnMessages.setText(sap.ui.getCore().getMessageManager().getMessageModel().getData().length);                                                                                                                                         
                                                                                                                                                                                                                                                               
                        try {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            var rMessage = JSON.parse(oError.responseText);                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                            if (rMessage.error.code == "005056A509B11EE1B9A8DBD9EA7BB778") {                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                let sMessage = [];                                                                                                                                                                                                             
                                sMessage.push({                                                                                                                                                                                                                
                                    message: "Erro ao ler excel, existe(em) campo(os) com dado(os) diferente(es) do tipo solicitado ou modelo utilizado ou vazios/utilizando modelo diferente do solicitado.",                                                 
                                    type: "Error"                                                                                                                                                                                                              
                                });                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                oModelMessageManager.setData(sMessage);                                                                                                                                                                                        
                                oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                oBtnMessages.setText("1");                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        } catch (error) {                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            console.log(error);                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        try {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            if (sap.ui.getCore().getMessageManager().getMessageModel().getData().length == 0) {                                                                                                                                                
                                                                                                                                                                                                                                                               
                                console.log(oError);                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                                let oModelMessageManager = new JSONModel();                                                                                                                                                                                    
                                let sMessage = [];                                                                                                                                                                                                             
                                sMessage.push({                                                                                                                                                                                                                
                                    message: "Erro ao processar dados, porém não foi retornado nenhum dado, carga não realizada.",                                                                                                                             
                                    type: "Error"                                                                                                                                                                                                              
                                });                                                                                                                                                                                                                            
                                sMessage.push({                                                                                                                                                                                                                
                                    message: "Se erro persistir, contacte o suporte.",                                                                                                                                                                         
                                    type: "Information"                                                                                                                                                                                                        
                                });                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                oModelMessageManager.setData(sMessage);                                                                                                                                                                                        
                                oMessageView.setModel(oModelMessageManager);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                oBtnMessages.setText("1");                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        } catch (error) {                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            console.log(error);                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        oBtnMessages.setIcon(IconPool.getIconURI("message-error"));                                                                                                                                                                            
                        oBtnMessages.setType("Negative");                                                                                                                                                                                                      
                        oBtnMessages.setVisible(true);                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        oMessageView.navigateBack();                                                                                                                                                                                                           
                        oBackButtonMessage.setVisible(false);                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        oMessageDialog.open();                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                        sap.m.MessageToast.show("Erro ao receber erros retornados do processamento, carga não realizada.");                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    try {                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        oUploadDialog.setBusy(false);                                                                                                                                                                                                          
                        oBtnClose.setEnabled(true);                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    } catch (error) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                        console.log(error);                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            handleTypeMissmatch: function (oEvent) {                                                                                                                                                                                                           
                var aFileTypes = oEvent.getSource().getFileType();                                                                                                                                                                                             
                jQuery.each(aFileTypes, function (key, value) { aFileTypes[key] = "*." + value; });                                                                                                                                                            
                var sSupportedFileTypes = aFileTypes.join(", ");                                                                                                                                                                                               
                sap.m.MessageToast.show("Tipo de arquivo *." + oEvent.getParameter("fileType") +                                                                                                                                                               
                    " não é suportado. Escolha um dos tipos a seguir: " +                                                                                                                                                                                      
                    sSupportedFileTypes);                                                                                                                                                                                                                      
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            UploadComplete: function (oEvent, oTable) {                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                // Libera a tela - não mais inativa                                                                                                                                                                                                            
                oUploadDialog.setBusy(false);                                                                                                                                                                                                                  
                oBtnClose.setEnabled(true);                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                // Atualiza tabela do relatório após carga                                                                                                                                                                                                     
                if (oTable) {                                                                                                                                                                                                                                  
                    oTable.getModel().refresh(true);                                                                                                                                                                                                           
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                // Verifica o retorno da mensagem                                                                                                                                                                                                              
                if (oEvent.mParameters.status == '200' ||                                                                                                                                                                                                      
                    oEvent.mParameters.status == '201') {                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                    oUploadDialog.close();                                                                                                                                                                                                                     
                    //Não foi possível pegar retorno de mensagens de sucesso                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    sap.m.MessageToast.show("Carga realizada com sucesso.");                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                else {                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    if (oEvent.mParameters.response) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        if (oEvent.mParameters.responseRaw.search("<message>")) {                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            var sResponse = oEvent.mParameters.responseRaw.split("<message>")[1].split("</message>")[0];                                                                                                                                       
                                                                                                                                                                                                                                                               
                            let sMessage = [];                                                                                                                                                                                                                 
                            sMessage.push({                                                                                                                                                                                                                    
                                message: sResponse,                                                                                                                                                                                                            
                                type: "Error"                                                                                                                                                                                                                  
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                            var oModelMessageManagerError = new JSONModel();                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            oModelMessageManagerError.setData(sMessage);                                                                                                                                                                                       
                            oMessageView.setModel(oModelMessageManagerError);                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            oBtnMessages.setText("1");                                                                                                                                                                                                         
                            oBtnMessages.setIcon(IconPool.getIconURI("message-error"));                                                                                                                                                                        
                            oBtnMessages.setType("Negative");                                                                                                                                                                                                  
                            oBtnMessages.setVisible(true);                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                            oMessageView.navigateBack();                                                                                                                                                                                                       
                            oBackButtonMessage.setVisible(false);                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                            oMessageDialog.open();                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                            oUploadDialog.setBusy(false);                                                                                                                                                                                                      
                            oBtnClose.setEnabled(true);                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        } else {                                                                                                                                                                                                                               
                            //Tratar                                                                                                                                                                                                                           
                            alert("Return Code: " + oEvent.mParameters.response, "Response", "Response");                                                                                                                                                      
                        }                                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
            onGetUrl: function (oEvent) {                                                                                                                                                                                                                      
                let table = oEvent.getSource().getParent().getParent();                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                let selecoes = table.getSelectedContexts();                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                let selecionado = selecoes[0];                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                let parametros = selecionado.getProperty();                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                // Remove mensagens do processo                                                                                                                                                                                                                
                try {                                                                                                                                                                                                                                          
                    sap.ui.getCore().getMessageManager().removeAllMessages();                                                                                                                                                                                  
                } catch (error) { }                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    oViewComponent.getModel().callFunction("/toGetUrl",                                                                                                                                                                                        
                        {                                                                                                                                                                                                                                      
                            method: "POST",                                                                                                                                                                                                                    
                            urlParameters: {                                                                                                                                                                                                                   
                                "Guid": parametros.Guid                                                                                                                                                                                                        
                            },                                                                                                                                                                                                                                 
                            success: function (oData, response) {                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                                //Pega primeiro registro com a url                                                                                                                                                                                             
                                let sMessage = sap.ui.getCore().getMessageManager().getMessageModel().getData()[0];                                                                                                                                            
                                                                                                                                                                                                                                                               
                                var URLHelper = MobileLibrary.URLHelper;                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                URLHelper.redirect(sMessage.message, true);                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            error: function (oError) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                sap.m.MessageToast.show(oI18n.getText("errortoReceiverUrl"));                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            }.bind(this),                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            refreshAfterChange: true                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                        });                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                } catch (error) {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    oThisContext.handlerError(oI18n.getText("errortoReceiverUrl"));                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
        };                                                                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               