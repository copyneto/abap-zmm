sap.ui.define([],                                                                                                                                                                                                                                              
    function () {                                                                                                                                                                                                                                              
        "use strict";                                                                                                                                                                                                                                          
        return {                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            onInit() {                                                                                                                                                                                                                                         
                debugger;                                                                                                                                                                                                                                      
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onBeforeRendering: function () {                                                                                                                                                                                                                   
                debugger;                                                                                                                                                                                                                                      
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onAfterRendering: function () {                                                                                                                                                                                                                    
                debugger;                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                let oModel = sap.ui.getCore().byId("br.com.trescoracoes.administraremissaonf::sap.suite.ui.generic.template.ListReport.view.ListReport::Emissao--listReport").getModel();                                                                      
                                                                                                                                                                                                                                                               
                oModel.attachRequestCompleted(this.onCheckItems, this)                                                                                                                                                                                         
            },                                                                                                                                                                                                                                                 
            onCheckItems: function (oEvent) {                                                                                                                                                                                                                  
                let oModel = sap.ui.getCore().byId("br.com.trescoracoes.administraremissaonf::sap.suite.ui.generic.template.ListReport.view.ListReport::Emissao--listReport").getModel();                                                                      
                let that = this;                                                                                                                                                                                                                               
                oModel.detachRequestCompleted(that.onCheckItems, that);                                                                                                                                                                                        
                let oTable = sap.ui.getCore().byId("br.com.trescoracoes.administraremissaonf::sap.suite.ui.generic.template.ListReport.view.ListReport::Emissao--listReport").getTable().getBinding('rows');                                                   
                try {                                                                                                                                                                                                                                          
                    oTable.attachDataReceived(function (oEvent) {                                                                                                                                                                                              
                        oModel.read('/Limitador', {                                                                                                                                                                                                            
                            success: function (oData) {                                                                                                                                                                                                        
                                let limitador = '';                                                                                                                                                                                                            
                                let oTableLength = sap.ui.getCore().byId("br.com.trescoracoes.administraremissaonf::sap.suite.ui.generic.template.ListReport.view.ListReport::Emissao--listReport").getTable().getBinding("rows").getLength();                 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                               
                                if (oData.results[0].limitador <= 200) {                                                                                                                                                                                       
                                    limitador = oData.results[0].limitador                                                                                                                                                                                     
                                } else {                                                                                                                                                                                                                       
                                    limitador = 200;                                                                                                                                                                                                           
                                }                                                                                                                                                                                                                              
                                if (oTableLength <= limitador ) {                                                                                                                                                                                              
                                    limitador = oTableLength;                                                                                                                                                                                                  
                                }                                                                                                                                                                                                                              
                                sap.ui.getCore().byId("br.com.trescoracoes.administraremissaonf::sap.suite.ui.generic.template.ListReport.view.ListReport::Emissao--listReport").getTable().getPlugins()[0].setSelectionInterval(0, limitador)                 
                            },                                                                                                                                                                                                                                 
                            error: function (oError) {                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                reject(oError);                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                        });                                                                                                                                                                                                                                    
                    })                                                                                                                                                                                                                                         
                } catch (error) {                                                                                                                                                                                                                              
                    //segue o processo                                                                                                                                                                                                                         
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
            onChangeCheckBoxUpdate: function (oEvent) {                                                                                                                                                                                                        
                if (this.getView().getModel().hasPendingChanges()) {                                                                                                                                                                                           
                    this.getView().getModel().submitChanges()                                                                                                                                                                                                  
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onChangeAvailableCheckBoxAction: function (oEvent) {                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                var that = this;                                                                                                                                                                                                                               
                var oCheckbox = oEvent.getSource();                                                                                                                                                                                                            
                var oBindingContext = oEvent.getSource().getBindingContext();                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Verifica se Checkbox foi marcado e atualiza campo montante                                                                                                                                                                                     
                =================================================================== */                                                                                                                                                                         
                if (oCheckbox.getSelected()) {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    /* Recupera a tabela e o campo do relatório */                                                                                                                                                                                             
                    var oData = this.getView().getModel().getProperty(oEvent.getSource().getBindingContext().sPath);                                                                                                                                           
                    oData.UsedStock_conve = oData.AvailableStock_Conve;                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    /* Atualiza diretamente o relatório */                                                                                                                                                                                                     
                    var vUsedStockConvePath = oEvent.getSource().getBindingContext().sPath + '/UsedStock_conve';                                                                                                                                               
                    this.getView().getModel().setProperty(vUsedStockConvePath, oData.UsedStock_conve);                                                                                                                                                         
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama Action no Behavior da CDS&nbsp;                                                                                                                                                                                                          
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function () {                                                                                                                                                                                                                 
                    return new Promise(function (fnResolve, fnReject) {                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        that.extensionAPI.invokeActions(                                                                                                                                                                                                       
                            "/fragmentCheckBox",                                                                                                                                                                                                               
                            oBindingContext,                                                                                                                                                                                                                   
                            {                                                                                                                                                                                                                                  
                                "UseAvailableCheckBox": oBindingContext.getObject().UseAvailableCheckBox ? true : false                                                                                                                                        
                            },                                                                                                                                                                                                                                 
                        ).then(function (data) {                                                                                                                                                                                                               
                            fnResolve();                                                                                                                                                                                                                       
                            that.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                       
                        });                                                                                                                                                                                                                                    
                    });                                                                                                                                                                                                                                        
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var mParameters = {                                                                                                                                                                                                                            
                    busy: {                                                                                                                                                                                                                                    
                        set: true,                                                                                                                                                                                                                             
                        check: false                                                                                                                                                                                                                           
                    },                                                                                                                                                                                                                                         
                    dataloss: {                                                                                                                                                                                                                                
                        popup: false,                                                                                                                                                                                                                          
                        navigation: false                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                };                                                                                                                                                                                                                                             
                this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                                   
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onChangeUsedStockAction: function (oEvent) {                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                var that = this;                                                                                                                                                                                                                               
                var oInput = oEvent.getSource();                                                                                                                                                                                                               
                var oBindingContext = oEvent.getSource().getBindingContext();                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Seta valor máximo do campo Input                                                                                                                                                                                                               
                =================================================================== */                                                                                                                                                                         
                //if (!oInput.getMax()) {                                                                                                                                                                                                                      
                //    oInput.setMax(parseFloat(oBindingContext.getObject().AvailableStock_Conve));                                                                                                                                                             
                //}                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Se valor for maior que o máximo, apenas voltar. Como setamos acima o&nbsp;                                                                                                                                                                     
                novo valor do máximo, o SetupInput vai fazer a tratativa do erro                                                                                                                                                                               
                =================================================================== */                                                                                                                                                                         
                //if (oInput.getValue() > oInput.getMax()) {                                                                                                                                                                                                   
                //    return;                                                                                                                                                                                                                                  
                //}                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Limpa status de validações anteriores&nbsp;                                                                                                                                                                                                    
                =================================================================== */                                                                                                                                                                         
                //oInput.setValueState( sap.ui.core.ValueState.None );                                                                                                                                                                                         
                //oInput.setValueStateText( '' );                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                O Exemplo acima fica com algum lixo quando setamos o valor máximo.                                                                                                                                                                             
                A solução abaixo é mais simples, montamos a mensagem de erro                                                                                                                                                                                   
                =================================================================== */                                                                                                                                                                         
                if (oInput.getValue() > oBindingContext.getObject().AvailableStock_Conve) {                                                                                                                                                                    
                    oInput.setValueState(sap.ui.core.ValueState.Error);                                                                                                                                                                                        
                    oInput.setValueStateText('Insira um número menor ou igual a ' + oBindingContext.getObject().AvailableStock_Conve);                                                                                                                         
                    return;                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var vNewUsedStock = parseFloat(oInput.getValue());                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Chama Action no Behavior da CDS&nbsp;                                                                                                                                                                                                          
                =================================================================== */                                                                                                                                                                         
                var fnFunction = function () {                                                                                                                                                                                                                 
                    return new Promise(function (fnResolve, fnReject) {                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        that.extensionAPI.invokeActions(                                                                                                                                                                                                       
                            "/fragmentUsedStock",                                                                                                                                                                                                              
                            oBindingContext,                                                                                                                                                                                                                   
                            {                                                                                                                                                                                                                                  
                                "NewUsedStock": vNewUsedStock                                                                                                                                                                                                  
                            },                                                                                                                                                                                                                                 
                        ).then(function (data) {                                                                                                                                                                                                               
                            fnResolve();                                                                                                                                                                                                                       
                            that.templateBaseExtension.getExtensionAPI().refreshTable();                                                                                                                                                                       
                        });                                                                                                                                                                                                                                    
                    });                                                                                                                                                                                                                                        
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                var mParameters = {                                                                                                                                                                                                                            
                    busy: {                                                                                                                                                                                                                                    
                        set: true,                                                                                                                                                                                                                             
                        check: false                                                                                                                                                                                                                           
                    },                                                                                                                                                                                                                                         
                    dataloss: {                                                                                                                                                                                                                                
                        popup: false,                                                                                                                                                                                                                          
                        navigation: false                                                                                                                                                                                                                      
                    }                                                                                                                                                                                                                                          
                };                                                                                                                                                                                                                                             
                this.extensionAPI.securedExecution(fnFunction, mParameters);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onActionNavigateR07: function (oEvent) {                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Recupa referência à tabela do relatório                                                                                                                                                                                                        
                =================================================================== */                                                                                                                                                                         
                let oItems = this.templateBaseExtension.getExtensionAPI().getSelectedContexts();                                                                                                                                                               
                                                                                                                                                                                                                                                               
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Navegação para nenhuma linha selecionada                                                                                                                                                                                                       
                =================================================================== */                                                                                                                                                                         
                if (!oItems.length) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    /* ===================================================================&nbsp;                                                                                                                                                               
                    Verifica se usuário tem permissão para navegação&nbsp;                                                                                                                                                                                     
                    =================================================================== */                                                                                                                                                                     
                    sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([                                                                                                                                                      
                        { target: { shellHash: "visaoremessaretorno-display" } }                                                                                                                                                                               
                    ])                                                                                                                                                                                                                                         
                        .done(function (aResponse) {                                                                                                                                                                                                           
                            aResponse.map(function (elem, index) {                                                                                                                                                                                             
                                if (elem.supported === true) {                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                    /* ===================================================================&nbsp;                                                                                                                                               
                                    Chama outro aplicativo                                                                                                                                                                                                     
                                    =================================================================== */                                                                                                                                                     
                                    var href = (sap.ushell && sap.ushell.Container && sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({                                                                                          
                                        target: { semanticObject: "visaoremessaretorno", action: "display" },                                                                                                                                                  
                                        params: {}                                                                                                                                                                                                             
                                    })) || "";                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                    sap.m.URLHelper.redirect(href, false);                                                                                                                                                                                     
                                }                                                                                                                                                                                                                              
                                else {                                                                                                                                                                                                                         
                                    alert('Usuário sem permissão para acessar o link');                                                                                                                                                                        
                                }                                                                                                                                                                                                                              
                            })                                                                                                                                                                                                                                 
                        })                                                                                                                                                                                                                                     
                        .fail(function () {                                                                                                                                                                                                                    
                            alert('Falha ao acessar o link');                                                                                                                                                                                                  
                        });                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                /* ===================================================================&nbsp;                                                                                                                                                                   
                Navegação para uma linha selecionada                                                                                                                                                                                                           
                =================================================================== */                                                                                                                                                                         
                else if (oItems.length == 1) {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    /* ===================================================================&nbsp;                                                                                                                                                               
                    Verifica se usuário tem permissão para navegação&nbsp;                                                                                                                                                                                     
                    =================================================================== */                                                                                                                                                                     
                    sap.ushell.Container.getService("CrossApplicationNavigation").isNavigationSupported([                                                                                                                                                      
                        { target: { shellHash: "visaoremessaretorno-display" } }                                                                                                                                                                               
                    ])                                                                                                                                                                                                                                         
                        .done(function (aResponse) {                                                                                                                                                                                                           
                            aResponse.map(function (elem, index) {                                                                                                                                                                                             
                                if (elem.supported === true) {                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                                    /* ===================================================================&nbsp;                                                                                                                                               
                                    Chama outro aplicativo                                                                                                                                                                                                     
                                    =================================================================== */                                                                                                                                                     
                                    var href_parameters = (sap.ushell && sap.ushell.Container &&                                                                                                                                                               
                                        sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({                                                                                                                                        
                                            target: { semanticObject: "visaoremessaretorno", action: "display" },                                                                                                                                              
                                            params: {                                                                                                                                                                                                          
                                                OriginPlant: oItems[0].getObject().OriginPlant,                                                                                                                                                                
                                                DestinyPlant: oItems[0].getObject().DestinyPlant,                                                                                                                                                              
                                                Pedido: oItems[0].getObject().PurchaseOrder                                                                                                                                                                    
                                            }                                                                                                                                                                                                                  
                                        }));                                                                                                                                                                                                                   
                                    sap.m.URLHelper.redirect(href_parameters, false);                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                                }                                                                                                                                                                                                                              
                                else {                                                                                                                                                                                                                         
                                    alert('Usuário sem permissão para acessar o link');                                                                                                                                                                        
                                }                                                                                                                                                                                                                              
                            })                                                                                                                                                                                                                                 
                        })                                                                                                                                                                                                                                     
                        .fail(function () {                                                                                                                                                                                                                    
                            alert('Falha ao acessar o link');                                                                                                                                                                                                  
                        });                                                                                                                                                                                                                                    
                }                                                                                                                                                                                                                                              
                else {                                                                                                                                                                                                                                         
                    alert('Favor selecionar apenas uma linha');                                                                                                                                                                                                
                }                                                                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
        };                                                                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               