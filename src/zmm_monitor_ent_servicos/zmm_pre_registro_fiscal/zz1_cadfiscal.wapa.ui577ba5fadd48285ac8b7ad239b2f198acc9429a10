sap.ui.define([                                                                                                                                                                                                                                                
    "sap/m/MessageToast"                                                                                                                                                                                                                                       
],                                                                                                                                                                                                                                                             
    function (MessageToast){                                                                                                                                                                                                                                   
        "use strict";                                                                                                                                                                                                                                          
        return {                                                                                                                                                                                                                                               
            newAttachment: function(oEvent) {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                    
                    debugger;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                          
                    var oTable = oEvent.getSource().getParent();                                                                                                                                                                                               
                    var oSelection = this.extensionAPI.getSelectedContexts();                                                                                                                                                                                  
                    /* ===================================================================                                                                                                                                                                     
                    Cria Diálogo dinâmico (pop-up)                                                                                                                                                                                                             
                    =================================================================== */                                                                                                                                                                     
                    var oUploadDialog = new sap.m.Dialog({                                                                                                                                                                                                     
                        contentWidth: "300px",                                                                                                                                                                                                                 
                        resizable: true,                                                                                                                                                                                                                       
                        type: sap.m.DialogType.Message                                                                                                                                                                                                         
                    });                                                                                                                                                                                                                                        
                    oUploadDialog.setTitle("Carregar NF");                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                    /* ===================================================================                                                                                                                                                                     
                    Define o serviço gateway que será chamado                                                                                                                                                                                                  
                    =================================================================== */                                                                                                                                                                     
                    var sServiceUrl = "/sap/opu/odata/SAP/ZMM_PRE_REGISTRO_FISCAL_SRV/";                                                                                                                                                                       
                    var oModel = new sap.ui.model.odata.v2.ODataModel(sServiceUrl);                                                                                                                                                                            
                                                                                                                                                                                                                                                               
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                       
                    if (oSelection.length > 0) {                                                                                                                                                                                                               
                        var vNotaFiscal = oSelection.reduce(function (sText, oSelectedContext) {                                                                                                                                                               
                            return oSelectedContext.getObject();                                                                                                                                                                                               
                        }, "");                                                                                                                                                                                                                                
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    var sSource = `${sServiceUrl}PdfURLSet(NrNf='${vNotaFiscal.NrNf}',CnpjCpf='${vNotaFiscal.CnpjCpf}')/FileUploadSet`;                                                                                                                        
                    /* ===================================================================                                                                                                                                                                     
                    Prepara o responsável pela carga do arquivo                                                                                                                                                                                                
                    =================================================================== */                                                                                                                                                                     
                    // @ts-ignore                                                                                                                                                                                                                              
                    var oFileUploader = new sap.ui.unified.FileUploader({                                                                                                                                                                                      
                        width: "100%",                                                                                                                                                                                                                         
                        fileType: "pdf",                                                                                                                                                                                                                       
                        style: "Emphasized",                                                                                                                                                                                                                   
                        uploadComplete: function (oEvent) {                                                                                                                                                                                                    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                       
                            oUploadDialog.close();                                                                                                                                                                                                             
                            oUploadDialog.destroy();                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                            // Verifica o retorno da mensagem                                                                                                                                                                                                  
                            if (oEvent.mParameters.status == '200' ||                                                                                                                                                                                          
                                oEvent.mParameters.status == '201') {                                                                                                                                                                                          
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                               
                                oTable.getModel().refresh(true);                                                                                                                                                                                               
                                sap.m.MessageToast.show("Carga realizada com sucesso.");                                                                                                                                                                       
                            }                                                                                                                                                                                                                                  
                            else {                                                                                                                                                                                                                             
                                if (oEvent.mParameters.response) {                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                    alert("Return Code: " + oEvent.mParameters.response);                                                                                                                                                                      
                                }                                                                                                                                                                                                                              
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        }.bind(this)                                                                                                                                                                                                                           
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    /* ===================================================================                                                                                                                                                                     
                   Define parâmetros                                                                                                                                                                                                                           
                    =================================================================== */                                                                                                                                                                     
                    oFileUploader.setName("Simple Uploader");                                                                                                                                                                                                  
                    oFileUploader.setUploadUrl(String(sSource));                                                                                                                                                                                               
                    oFileUploader.setSendXHR(true);                                                                                                                                                                                                            
                    oFileUploader.setUseMultipart(false);                                                                                                                                                                                                      
                    oFileUploader.setUploadOnChange(false);                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                    var oToken = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                                    
                        name: "x-csrf-token",                                                                                                                                                                                                                  
                        value: oModel.getSecurityToken()                                                                                                                                                                                                       
                    });                                                                                                                                                                                                                                        
                    oFileUploader.insertHeaderParameter(oToken, 0);                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    /* ===================================================================                                                                                                                                                                     
                    Cria botão para a carga do arquivo                                                                                                                                                                                                         
                    =================================================================== */                                                                                                                                                                     
                    var oTriggerButton = new sap.m.Button({                                                                                                                                                                                                    
                        text: 'Upload',                                                                                                                                                                                                                        
                        type: sap.m.ButtonType.Accept,                                                                                                                                                                                                         
                        press: function () {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            // Verifica se arquivo foi informado                                                                                                                                                                                               
                            var domRef = oFileUploader.getFocusDomRef();                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                            if (oFileUploader.getValue() === '') {                                                                                                                                                                                             
                                sap.m.MessageToast.show("Favor selecionar um arquivo");                                                                                                                                                                        
                                return;                                                                                                                                                                                                                        
                            }                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            var oContentType = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                      
                                name: "Content-Type",                                                                                                                                                                                                          
                                value: domRef.getAttribute('type')                                                                                                                                                                                             
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                            oFileUploader.insertHeaderParameter(oContentType, 0);                                                                                                                                                                              
                            oFileUploader.insertHeaderParameter(new sap.ui.unified.FileUploaderParameter({                                                                                                                                                     
                                name: "SLUG",                                                                                                                                                                                                                  
                                value: oFileUploader.getValue()                                                                                                                                                                                                
                            }), 1);                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                            oFileUploader.upload();                                                                                                                                                                                                            
                        }.bind(this)                                                                                                                                                                                                                           
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    /* ===================================================================                                                                                                                                                                     
                    Cria botão de cancelar                                                                                                                                                                                                                     
                    =================================================================== */                                                                                                                                                                     
                    var oCancelButton = new sap.m.Button({                                                                                                                                                                                                     
                        text: 'Cancelar',                                                                                                                                                                                                                      
                        type: sap.m.ButtonType.Reject,                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                        press: function () {                                                                                                                                                                                                                   
                            oUploadDialog.close();                                                                                                                                                                                                             
                            oUploadDialog.destroy();                                                                                                                                                                                                           
                            this.getView().removeAllDependents();                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                        }.bind(this)                                                                                                                                                                                                                           
                    });                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    /* ===================================================================                                                                                                                                                                     
                    Chama diálogo com a lógica de carga                                                                                                                                                                                                        
                    =================================================================== */                                                                                                                                                                     
                    oUploadDialog.addContent(oFileUploader);                                                                                                                                                                                                   
                    oUploadDialog.setBeginButton(oTriggerButton);                                                                                                                                                                                              
                    oUploadDialog.setEndButton(oCancelButton);                                                                                                                                                                                                 
                    oUploadDialog.open();                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            showLogs: function(oEvent) {                                                                                                                                                                                                                       
                var oSelection = this.extensionAPI.getSelectedContexts();                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                var lo_model = oSelection[0].getObject();                                                                                                                                                                                                      
                var lv_externalref = lo_model.Empresa + lo_model.Filial + lo_model.Lifnr + lo_model.NrNf;                                                                                                                                                      
                                                                                                                                                                                                                                                               
                sap.ushell.Container.getServiceAsync('CrossApplicationNavigation')                                                                                                                                                                             
                    .then(function(res){                                                                                                                                                                                                                       
                        var hash = res.hrefForExternal({                                                                                                                                                                                                       
                                target: {semanticObject : 'ApplicationLog', action: 'showList'},                                                                                                                                                               
                                params: {                                                                                                                                                                                                                      
                                    LogObjectId: 'ZMM_MONITSERV_CADFIS',                                                                                                                                                                                       
                                    LogExternalId:lv_externalref,                                                                                                                                                                                              
                                    DateFrom:lo_model.DtLancto.toLocaleDateString().split('/').reverse().join('-')                                                                                                                                             
                                }                                                                                                                                                                                                                              
                            });                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                            var url = window.location.href.split('#')[0] + hash;                                                                                                                                                                               
                            sap.m.URLHelper.redirect(url, true);                                                                                                                                                                                               
                });                                                                                                                                                                                                                                            
            }                                                                                                                                                                                                                                                  
        };                                                                                                                                                                                                                                                     
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               