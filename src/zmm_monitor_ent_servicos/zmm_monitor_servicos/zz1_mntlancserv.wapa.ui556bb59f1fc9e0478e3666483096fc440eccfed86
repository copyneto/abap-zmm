sap.ui.define(                                                                                                                                                                                                                                                 
    ["sap/m/PDFViewer",                                                                                                                                                                                                                                        
     "sap/m/VBox",                                                                                                                                                                                                                                             
     "sap/m/Label",                                                                                                                                                                                                                                            
     "sap/ui/core/util/File"],                                                                                                                                                                                                                                 
function (PDFViewer, VBox, RadioButtonGroup, RadioButton, Label, File){                                                                                                                                                                                        
    "use strict";                                                                                                                                                                                                                                              
    return {                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
        ShowPdf: function(oEvent) {                                                                                                                                                                                                                            
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            // Recupera se foi selecionado uma linha                                                                                                                                                                                                           
           var oSelection = oEvent.getSource().getParent().getParent().getSelectedContexts();                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            if (oSelection.length > 0) {                                                                                                                                                                                                                       
            // Recupera a linha selecionada                                                                                                                                                                                                                    
            var vChave = oEvent.getSource().getParent().getParent().getSelectedContexts()[0].getObject();                                                                                                                                                      
            }                                                                                                                                                                                                                                                  
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
            //Chama servi√ßo gateway (SEGW)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                     
            var vServiceUrl = "/sap/opu/odata/SAP/ZMM_MONITOR_SERVICOS_SRV/";                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var sSource =                                                                                                                                                                                                                                      
            vServiceUrl + "ShowPDFSet(NrNf='" + vChave.NrNf + "',CnpjCpf='" + vChave.CnpjCpf + "',Linha='" + vChave.Linha + "')/$value";                                                                                                                       
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            var opdfViewer = new PDFViewer();&nbsp;                                                                                                                                                                                                            
            this.getView().addDependent(opdfViewer);&nbsp;                                                                                                                                                                                                     
            opdfViewer.setSource(sSource);&nbsp;                                                                                                                                                                                                               
            opdfViewer.setTitle("My PDF");&nbsp;                                                                                                                                                                                                               
            opdfViewer.setShowDownloadButton(false);                                                                                                                                                                                                           
            opdfViewer.open();                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                               
        onAnexar: function (oEvent) {                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
            let oTable = oEvent.getSource().getParent().getParent();                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
             Cria Dialogo dinamico (pop-up)                                                                                                                                                                                                                    
            =================================================================== */                                                                                                                                                                             
            var oUploadDialog = new sap.m.Dialog({                                                                                                                                                                                                             
                contentWidth: "300px",                                                                                                                                                                                                                         
                resizable: true,                                                                                                                                                                                                                               
                type: "Message"                                                                                                                                                                                                                                
            });                                                                                                                                                                                                                                                
            oUploadDialog.setTitle("Anexar PDF");                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Define o servico gateway que ser chamado                                                                                                                                                                                                           
            =================================================================== */                                                                                                                                                                             
            var sServiceUrl = "/sap/opu/odata/SAP/ZMM_MONITOR_SERVICOS_SRV/";                                                                                                                                                                                  
            var oModel = new sap.ui.model.odata.ODataModel(sServiceUrl, false);                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Prepara o responsavel pela carga do arquivo                                                                                                                                                                                                        
            =================================================================== */                                                                                                                                                                             
            var oFileUploader = new sap.ui.unified.FileUploader({                                                                                                                                                                                              
                width: "100%",                                                                                                                                                                                                                                 
                uploadComplete: function (oEvent) {                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                    // Atualiza tabela do relatorio apos carga                                                                                                                                                                                                 
                    oTable.getModel().refresh(true);                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    oUploadDialog.close();                                                                                                                                                                                                                     
                    oUploadDialog.destroy();                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    // Verifica o retorno da mensagem                                                                                                                                                                                                          
                    if (oEvent.mParameters.status == '200' ||                                                                                                                                                                                                  
                        oEvent.mParameters.status == '201' ||                                                                                                                                                                                                  
                        oEvent.mParameters.status == '204') {                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                        sap.m.MessageToast.show("Carga realizada com sucesso.");                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                    else {                                                                                                                                                                                                                                     
                        alert("Return Code: " + oEvent.mParameters.response, "Response", "Response");                                                                                                                                                          
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Define parametros de Header                                                                                                                                                                                                                        
            =================================================================== */                                                                                                                                                                             
            oFileUploader.setName("Simple Uploader");                                                                                                                                                                                                          
            //oFileUploader.setUploadUrl(sSource);                                                                                                                                                                                                             
            oFileUploader.setSendXHR(true);                                                                                                                                                                                                                    
            oFileUploader.setUseMultipart(false);                                                                                                                                                                                                              
            oFileUploader.setUploadOnChange(false);                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            var oToken = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                                            
                name: "x-csrf-token",                                                                                                                                                                                                                          
                value: oModel.getSecurityToken()                                                                                                                                                                                                               
            });                                                                                                                                                                                                                                                
            oFileUploader.insertHeaderParameter(oToken);                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Cria botao para a carga do arquivo                                                                                                                                                                                                                 
            =================================================================== */                                                                                                                                                                             
            var oTriggerButton = new sap.m.Button({                                                                                                                                                                                                            
                text: 'Upload',                                                                                                                                                                                                                                
                type: 'Accept',                                                                                                                                                                                                                                
                press: function () {                                                                                                                                                                                                                           
                    debugger                                                                                                                                                                                                                                   
                    var sBaseKey = oTable.getBindingContext().getObject();                                                                                                                                                                                     
                    var sSource = `${sServiceUrl}PdfurlSet(NrNf='${sBaseKey.NrNf}',CnpjCpf='${sBaseKey.CnpjCpf}',Linha='')/UploadSet`;                                                                                                                         
                                                                                                                                                                                                                                                               
                    oFileUploader.setUploadUrl(sSource);                                                                                                                                                                                                       
                    debugger                                                                                                                                                                                                                                   
                    // Verifica se arquivo foi informado                                                                                                                                                                                                       
                    var domRef = oFileUploader.getFocusDomRef();                                                                                                                                                                                               
                    var file = domRef.files[0];                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    if (oFileUploader.getValue() === '') {                                                                                                                                                                                                     
                        sap.m.MessageToast.show("Favor selecionar um arquivo");                                                                                                                                                                                
                        return;                                                                                                                                                                                                                                
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    var oContentType = new sap.ui.unified.FileUploaderParameter({                                                                                                                                                                              
                        name: "Content-Type",                                                                                                                                                                                                                  
                        value: file.type                                                                                                                                                                                                                       
                    });                                                                                                                                                                                                                                        
                    oFileUploader.insertHeaderParameter(oContentType);                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                    oFileUploader.insertHeaderParameter(new sap.ui.unified.FileUploaderParameter({                                                                                                                                                             
                        name: "SLUG",                                                                                                                                                                                                                          
                        value: oFileUploader.getValue()                                                                                                                                                                                                        
                    }));                                                                                                                                                                                                                                       
                    debugger                                                                                                                                                                                                                                   
                    oFileUploader.upload();                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
            });                                                                                                                                                                                                                                                
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Cria bot√£o de cancelar                                                                                                                                                                                                                             
            =================================================================== */                                                                                                                                                                             
            var oCancelButton = new sap.m.Button({                                                                                                                                                                                                             
                text: 'Cancelar',                                                                                                                                                                                                                              
                type: 'Reject',                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                press: function () {                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
                    oUploadDialog.close();                                                                                                                                                                                                                     
                    oUploadDialog.destroy();                                                                                                                                                                                                                   
                    this.getView().removeAllDependents();                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                }.bind(this)                                                                                                                                                                                                                                   
            });                                                                                                                                                                                                                                                
            /* ===================================================================&nbsp;                                                                                                                                                                       
            Chama dialogo com a logica de carga&nbsp;                                                                                                                                                                                                          
            =================================================================== */                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            oUploadDialog.addContent(oFileUploader);                                                                                                                                                                                                           
            oUploadDialog.setBeginButton(oCancelButton);                                                                                                                                                                                                       
            oUploadDialog.setEndButton(oTriggerButton);                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
            oUploadDialog.open();                                                                                                                                                                                                                              
        }                                                                                                                                                                                                                                                      
    };                                                                                                                                                                                                                                                         
});                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               