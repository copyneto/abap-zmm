sap.ui.define(                                                                                                                                                                                                                                                 
    ["sap/m/PDFViewer"],                                                                                                                                                                                                                                       
    function (PDFViewer) {                                                                                                                                                                                                                                     
        "use strict";                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        return sap.ui.controller("br.com.trescoracoes.nriforms.ext.controller.ListReportExt",                                                                                                                                                                  
            {                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                showPdf: function (oEvent) {                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    // Recuperar referência a tabela de relatório                                                                                                                                                                                              
                    var oItems = sap.ui.getCore().byId(this.oView.sId + '--responsiveTable').getSelectedItems();                                                                                                                                               
                    const dadosAgrupados = {};                                                                                                                                                                                                                 
                    const dadosAgrupadosPO = [];                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    for (let i = 0; i < oItems.length; i++) {                                                                                                                                                                                                  
                        let line = oItems[i].getBindingContext().getObject();                                                                                                                                                                                  
                        if (!dadosAgrupados[line.PurchaseOrder]) {                                                                                                                                                                                             
                            dadosAgrupados[line.PurchaseOrder] = [];                                                                                                                                                                                           
                            dadosAgrupadosPO.push(line.PurchaseOrder);                                                                                                                                                                                         
                        }                                                                                                                                                                                                                                      
                        dadosAgrupados[line.PurchaseOrder].push(line);                                                                                                                                                                                         
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    for(let i = 0; i < dadosAgrupadosPO.length; i++){&nbsp;                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        let agrupador = dadosAgrupados[dadosAgrupadosPO[i]];&nbsp;                                                                                                                                                                             
                        let strPI = "";                                                                                                                                                                                                                        
                        let strPO = "";                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        for(let j = 0; j < agrupador.length; j++){&nbsp;                                                                                                                                                                                       
                            strPI = strPI + agrupador[j].PurchaseOrderItem + ";";                                                                                                                                                                              
                            strPO = agrupador[j].PurchaseOrder;                                                                                                                                                                                                
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var sServiceURL = "/sap/opu/odata/SAP/ZMM_FORMULARIO_NFI_ADOBE_SRV/";                                                                                                                                                                  
                        var sSource = sServiceURL + "PdfFileSet(PurchaseOrder='" + strPO + "',filePdf='" + strPI + "',PurchaseOrderItem='" + "1" + "')/$value";                                                                                                
                        var opdfViewer = new PDFViewer();                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        this.getView().addDependent(opdfViewer);                                                                                                                                                                                               
                        opdfViewer.setSource(sSource);                                                                                                                                                                                                         
                        opdfViewer.setTitle("Formulário NRI");                                                                                                                                                                                                 
                        opdfViewer.downloadPDF();                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    /*// Recupera a linha selecionada&nbsp;                                                                                                                                                                                                    
                    var oSelection = this.extensionAPI.getSelectedContexts();                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                    if (oSelection.length > 0) {                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        var vNfi = oSelection.reduce(function (sText, oSelectedContext) {                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                            return oSelectedContext.getObject();                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                        }, "");                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    // Chama PDF Viewer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                  
                    var sServiceURL = "/sap/opu/odata/SAP/ZMM_FORMULARIO_NFI_ADOBE_SRV/";                                                                                                                                                                      
                    var sSource = sServiceURL + "PdfFileSet(PurchaseOrder='" + vNfi.PurchaseOrder + "',PurchaseOrderItem='" + vNfi.PurchaseOrderItem + "',filePdf='" + "" + "')/$value";                                                                       
                    var opdfViewer = new PDFViewer();                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    this.getView().addDependent(opdfViewer);                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                    opdfViewer.setSource(sSource);                                                                                                                                                                                                             
                    opdfViewer.setTitle("Formulário NRI");                                                                                                                                                                                                     
                    opdfViewer.open();*/                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                },                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                baixarPdf: function (oEvent) {                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                    // Recuperar referência a tabela de relatório                                                                                                                                                                                              
                    var oItems = sap.ui.getCore().byId(this.oView.sId + '--responsiveTable').getSelectedItems();                                                                                                                                               
                    const dadosAgrupados = {};                                                                                                                                                                                                                 
                    const dadosAgrupadosPO = [];                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    for (let i = 0; i < oItems.length; i++) {                                                                                                                                                                                                  
                        let line = oItems[i].getBindingContext().getObject();                                                                                                                                                                                  
                        if (!dadosAgrupados[line.PurchaseOrder]) {                                                                                                                                                                                             
                            dadosAgrupados[line.PurchaseOrder] = [];                                                                                                                                                                                           
                            dadosAgrupadosPO.push(line.PurchaseOrder);                                                                                                                                                                                         
                        }                                                                                                                                                                                                                                      
                        dadosAgrupados[line.PurchaseOrder].push(line);                                                                                                                                                                                         
                    }                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
                    for(let i = 0; i < dadosAgrupadosPO.length; i++){&nbsp;                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                        let agrupador = dadosAgrupados[dadosAgrupadosPO[i]];&nbsp;                                                                                                                                                                             
                        let strPI = "";                                                                                                                                                                                                                        
                        let strPO = "";                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                        for(let j = 0; j < agrupador.length; j++){&nbsp;                                                                                                                                                                                       
                            strPI = strPI + agrupador[j].PurchaseOrderItem + ";";                                                                                                                                                                              
                            strPO = agrupador[j].PurchaseOrder;                                                                                                                                                                                                
                        }                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        var sServiceURL = "/sap/opu/odata/SAP/ZMM_FORMULARIO_NFI_ADOBE_SRV/";                                                                                                                                                                  
                        var sSource = sServiceURL + "PdfFileSet(PurchaseOrder='" + strPO + "',filePdf='" + strPI + "',PurchaseOrderItem='" + "" + "')/$value";                                                                                                 
                        var opdfViewer = new PDFViewer();                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                        this.getView().addDependent(opdfViewer);                                                                                                                                                                                               
                        opdfViewer.setSource(sSource);                                                                                                                                                                                                         
                        opdfViewer.setTitle("Formulário NRI");                                                                                                                                                                                                 
                        opdfViewer.downloadPDF();                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            });                                                                                                                                                                                                                                                
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               